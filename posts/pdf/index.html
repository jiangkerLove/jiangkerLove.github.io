<!DOCTYPE html>
<html lang="en">

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Allow having a localized datetime different from the appearance language -->
  

  

    

    

  

  

  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.2.2">
<meta property="og:title" content="Android PDF的读取和写入">
<meta name="author" content="jiangker">
<meta property="og:locale" content="en">
<meta name="description" content="官方组件">
<meta property="og:description" content="官方组件">
<link rel="canonical" href="http://0.0.0.0:4000/posts/pdf/">
<meta property="og:url" content="http://0.0.0.0:4000/posts/pdf/">
<meta property="og:site_name" content="Jiangker">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2024-08-01T14:08:00+08:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Android PDF的读取和写入">
<meta name="twitter:site" content="@twitter_username">
<meta name="twitter:creator" content="@jiangker">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"jiangker"},"dateModified":"2024-08-01T14:08:00+08:00","datePublished":"2024-08-01T14:08:00+08:00","description":"官方组件","headline":"Android PDF的读取和写入","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/posts/pdf/"},"url":"http://0.0.0.0:4000/posts/pdf/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>Android PDF的读取和写入 | Jiangker
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Jiangker">
<meta name="application-name" content="Jiangker">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  

    
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net">
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&amp;display=swap">

  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/style.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  
    <!--
  Switch the mode between dark and light.
-->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get MODE_ATTR() { return "data-mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }
    static get ID() { return "mode-toggle"; }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      let self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener("change", () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }

          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.notify();

      });

    } /* constructor() */

    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }

    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }

    get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; }

    get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; }

    get hasMode() { return this.mode != null; }

    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage({
        direction: ModeToggle.ID,
        message: this.modeStatus
      }, "*");
    }

  } /* ModeToggle */

  const toggle = new ModeToggle();

  function flipMode() {
    if (toggle.hasMode) {
      if (toggle.isSysDarkPrefer) {
        if (toggle.isLightMode) {
          toggle.clearMode();
        } else {
          toggle.setLight();
        }

      } else {
        if (toggle.isDarkMode) {
          toggle.clearMode();
        } else {
          toggle.setDark();
        }
      }

    } else {
      if (toggle.isSysDarkPrefer) {
        toggle.setLight();
      } else {
        toggle.setDark();
      }
    }

    toggle.notify();

  } /* flipMode() */

</script>

  
</head>


  <body data-spy="scroll" data-target="#toc" data-topbar-visible="true">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" class="mx-auto">
        
          
          <img src="/assets/img/avatar.jpeg" alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">Jiangker</a>
    </div>
    <div class="site-subtitle font-italic">record coding learning</div>

  </div>
<!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">

    
      <button class="mode-toggle btn" aria-label="Switch Mode">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
      <a href="javascript:location.href%20=%20'mailto:'%20+%20%5B'niklaus1996','icloud.com'%5D.join('@')" aria-label="email">
        <i class="fas fa-envelope"></i>
      </a>
      

    

  </div> <!-- .sidebar-bottom -->

</div>
<!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper">
  <div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/">
              Home
            </a>
          </span>

        

      

        

      

        

          
            <span>Android PDF的读取和写入</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search...">
    </span>
    <span id="search-cancel">Cancel</span>
  </div>

</div>


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div id="main" class="container pl-xl-4 pr-xl-4">

        









<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4 pb-5">
    <div class="post pl-1 pr-1 pl-md-2 pr-md-2">

    

    
      
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Add attribute 'hide-bullet' to the checkbox list -->



<!-- images -->




  
  

  
    
      
      
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  




<!-- Wrap prompt element of blockquote with the <div> tag -->







<!-- return -->





<h1 data-toc-skip>Android PDF的读取和写入</h1>

<div class="post-meta text-muted">
    <!-- published date -->
    <span>
      Posted
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="" data-ts="1722492480" data-df="ll" data-toggle="tooltip" data-placement="bottom">
  Aug  1, 2024
</em>

    </span>

    <!-- lastmod date -->
    

  

  <div class="d-flex justify-content-between">
    <!-- author -->
    <span>
      
      

      

      By

      <em>
        
        jiangker
        
      </em>
    </span>

    <div>
      <!-- page views -->
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1782 words">
  <em>9 min</em> read</span>

    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <h3 id="官方组件">
<span class="mr-2">官方组件</span><a href="#%E5%AE%98%E6%96%B9%E7%BB%84%E4%BB%B6" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>主要依赖<code class="language-plaintext highlighter-rouge">PdfRenderer</code>来进行读取，读取到会转换位<code class="language-plaintext highlighter-rouge">bitmap</code>，就可以展示到页面中去。然后使用<code class="language-plaintext highlighter-rouge">PdfDocument</code>来进行写回，这里主要是<code class="language-plaintext highlighter-rouge">canvas</code>的绘制。</p>

<p>简单制作一个绘制，然后将结果保存到文件的功能</p>

<h4 id="pdf读取">
<span class="mr-2">PDF读取</span><a href="#pdf%E8%AF%BB%E5%8F%96" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h4>

<div class="language-kotlin highlighter-rouge">
<div class="code-header">
        <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td>
<td class="rouge-code"><pre><span class="kd">val</span> <span class="py">resources</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">resources</span>
<span class="kd">val</span> <span class="py">dm</span> <span class="p">=</span> <span class="n">resources</span><span class="p">.</span><span class="n">displayMetrics</span>
<span class="kd">val</span> <span class="py">screenWidth</span> <span class="p">=</span> <span class="n">dm</span><span class="p">.</span><span class="n">widthPixels</span>

<span class="kd">val</span> <span class="py">pdfFile</span> <span class="p">=</span> <span class="nc">ParcelFileDescriptor</span><span class="p">.</span><span class="k">open</span><span class="p">(</span>
    <span class="nc">File</span><span class="p">(</span><span class="n">filesDir</span><span class="p">.</span><span class="n">path</span> <span class="p">+</span> <span class="s">"/api.pdf"</span><span class="p">),</span>
    <span class="nc">ParcelFileDescriptor</span><span class="p">.</span><span class="nc">MODE_READ_ONLY</span>
<span class="p">)</span>
<span class="c1">// pdf 总的高度</span>
<span class="kd">var</span> <span class="py">totalHeight</span> <span class="p">=</span> <span class="mf">0F</span>
<span class="c1">// 存储pdf的页面bitmap</span>
<span class="kd">val</span> <span class="py">pages</span> <span class="p">=</span> <span class="n">mutableStateListOf</span><span class="p">&lt;</span><span class="nc">Bitmap</span><span class="p">&gt;()</span>
<span class="c1">// 构建pdf读取对象</span>
<span class="kd">val</span> <span class="py">renderer</span> <span class="p">=</span> <span class="nc">PdfRenderer</span><span class="p">(</span><span class="n">pdfFile</span><span class="p">)</span>
<span class="c1">// 记录每个页面的起始位置，方便后续会写</span>
<span class="kd">val</span> <span class="py">itemOffset</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="nc">Float</span><span class="p">&gt;()</span>
<span class="n">itemOffset</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="mf">0F</span><span class="p">)</span>
<span class="nf">repeat</span><span class="p">(</span><span class="n">renderer</span><span class="p">.</span><span class="n">pageCount</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 获取单页的pdf</span>
    <span class="kd">val</span> <span class="py">openPage</span> <span class="p">=</span> <span class="n">renderer</span><span class="p">.</span><span class="nf">openPage</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
    <span class="c1">// 计算pdf页面高度，因为这里使宽度等于屏幕宽度，所以长度也需要等比例变化</span>
    <span class="kd">val</span> <span class="py">height</span> <span class="p">=</span> <span class="n">screenWidth</span><span class="p">.</span><span class="nf">toFloat</span><span class="p">()</span> <span class="p">/</span> <span class="n">openPage</span><span class="p">.</span><span class="n">width</span> <span class="p">*</span> <span class="n">openPage</span><span class="p">.</span><span class="n">height</span>
    <span class="n">totalHeight</span> <span class="p">+=</span> <span class="n">height</span>
    <span class="n">itemOffset</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">totalHeight</span><span class="p">)</span>
    <span class="c1">// 生成bitmap</span>
    <span class="kd">val</span> <span class="py">bitmap</span> <span class="p">=</span> <span class="nc">Bitmap</span><span class="p">.</span><span class="nf">createBitmap</span><span class="p">(</span><span class="n">screenWidth</span><span class="p">,</span> <span class="n">height</span><span class="p">.</span><span class="nf">toInt</span><span class="p">(),</span> <span class="nc">Bitmap</span><span class="p">.</span><span class="nc">Config</span><span class="p">.</span><span class="nc">ARGB_8888</span><span class="p">)</span>
    <span class="c1">// 把pdf拷贝到bitmap上去</span>
    <span class="n">openPage</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="n">bitmap</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="nc">PdfRenderer</span><span class="p">.</span><span class="nc">Page</span><span class="p">.</span><span class="nc">RENDER_MODE_FOR_DISPLAY</span><span class="p">)</span>
    <span class="n">pages</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">bitmap</span><span class="p">)</span>
    <span class="n">openPage</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<p>以上代码对<code class="language-plaintext highlighter-rouge">pdf</code>进行了简单的读取，作为演示<code class="language-plaintext highlighter-rouge">demo</code>，存在几个问题</p>
<ul>
  <li>一次性读取了所有页面，页面较多时，内存压力大，读取也较慢</li>
  <li>只对比屏幕进行了对应大小的读取，所以没有缩放逻辑</li>
</ul>

<h4 id="绘制手势">
<span class="mr-2">绘制手势</span><a href="#%E7%BB%98%E5%88%B6%E6%89%8B%E5%8A%BF" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h4>

<div class="language-kotlin highlighter-rouge">
<div class="code-header">
        <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
</pre></td>
<td class="rouge-code"><pre><span class="kd">var</span> <span class="py">animationJob</span><span class="p">:</span> <span class="nc">Job</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>

<span class="nf">setContent</span> <span class="p">{</span>
    <span class="nc">Pdf_testTheme</span> <span class="p">{</span>
        <span class="c1">// A surface container using the 'background' color from the theme</span>
        <span class="kd">val</span> <span class="py">lazyListState</span> <span class="p">=</span> <span class="nf">rememberLazyListState</span><span class="p">()</span>
        <span class="kd">var</span> <span class="py">pointY</span> <span class="k">by</span> <span class="nf">remember</span> <span class="p">{</span>
            <span class="nf">mutableFloatStateOf</span><span class="p">(</span><span class="mf">0F</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="kd">val</span> <span class="py">coroutineScope</span> <span class="p">=</span> <span class="nf">rememberCoroutineScope</span><span class="p">()</span>

        <span class="kd">val</span> <span class="py">velocityTracker</span> <span class="p">=</span> <span class="nf">remember</span> <span class="p">{</span> <span class="nc">VelocityTracker</span><span class="p">.</span><span class="nf">obtain</span><span class="p">()</span> <span class="p">}</span>

        <span class="kd">val</span> <span class="py">path</span> <span class="p">=</span> <span class="nf">remember</span> <span class="p">{</span> <span class="n">mutableStateListOf</span><span class="p">&lt;</span><span class="nc">Pair</span><span class="p">&lt;</span><span class="nc">Float</span><span class="p">,</span> <span class="nc">Float</span><span class="p">&gt;&gt;()</span> <span class="p">}</span>

        <span class="kd">val</span> <span class="py">paths</span> <span class="p">=</span> <span class="nf">remember</span> <span class="p">{</span> <span class="n">mutableStateListOf</span><span class="p">&lt;</span><span class="nc">List</span><span class="p">&lt;</span><span class="nc">Pair</span><span class="p">&lt;</span><span class="nc">Float</span><span class="p">,</span> <span class="nc">Float</span><span class="p">&gt;&gt;&gt;()</span> <span class="p">}</span>

        <span class="kd">var</span> <span class="py">isMove</span> <span class="p">=</span> <span class="nf">remember</span> <span class="p">{</span> <span class="k">false</span> <span class="p">}</span>

        <span class="nc">Surface</span><span class="p">(</span>
            <span class="n">modifier</span> <span class="p">=</span> <span class="nc">Modifier</span><span class="p">.</span><span class="nf">fillMaxSize</span><span class="p">(),</span>
            <span class="n">color</span> <span class="p">=</span> <span class="nc">MaterialTheme</span><span class="p">.</span><span class="n">colorScheme</span><span class="p">.</span><span class="n">background</span><span class="p">,</span>
        <span class="p">)</span> <span class="p">{</span>
            <span class="nc">LazyColumn</span><span class="p">(</span>
                <span class="n">modifier</span> <span class="p">=</span> <span class="nc">Modifier</span>
                    <span class="p">.</span><span class="nf">fillMaxSize</span><span class="p">()</span>
                    <span class="p">.</span><span class="nf">pointerInteropFilter</span> <span class="p">{</span> <span class="n">event</span> <span class="p">-&gt;</span>
                        <span class="k">when</span> <span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">actionMasked</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nc">MotionEvent</span><span class="p">.</span><span class="nc">ACTION_DOWN</span> <span class="p">-&gt;</span> <span class="p">{</span>
                                <span class="n">isMove</span> <span class="p">=</span> <span class="k">false</span>
                                <span class="n">pointY</span> <span class="p">=</span> <span class="n">event</span><span class="p">.</span><span class="n">y</span>
                                <span class="n">animationJob</span><span class="o">?.</span><span class="nf">cancel</span><span class="p">()</span>
                                <span class="n">animationJob</span> <span class="p">=</span> <span class="k">null</span>
                                <span class="n">velocityTracker</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
                                <span class="n">path</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
                                <span class="n">path</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">x</span> <span class="nf">to</span> <span class="p">(</span><span class="n">itemOffset</span><span class="p">[</span><span class="n">lazyListState</span><span class="p">.</span><span class="n">firstVisibleItemIndex</span><span class="p">]</span> <span class="p">+</span> <span class="n">lazyListState</span><span class="p">.</span><span class="n">firstVisibleItemScrollOffset</span><span class="p">)</span> <span class="p">+</span> <span class="n">event</span><span class="p">.</span><span class="n">y</span><span class="p">)</span>
                            <span class="p">}</span>

                            <span class="nc">MotionEvent</span><span class="p">.</span><span class="nc">ACTION_POINTER_DOWN</span> <span class="p">-&gt;</span> <span class="p">{</span>
                                <span class="n">isMove</span> <span class="p">=</span> <span class="k">true</span>
                                <span class="n">velocityTracker</span><span class="p">.</span><span class="nf">addMovement</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                            <span class="p">}</span>

                            <span class="nc">MotionEvent</span><span class="p">.</span><span class="nc">ACTION_MOVE</span> <span class="p">-&gt;</span> <span class="p">{</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">pointerCount</span> <span class="p">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="kd">val</span> <span class="py">move</span> <span class="p">=</span> <span class="n">pointY</span> <span class="p">-</span> <span class="n">event</span><span class="p">.</span><span class="n">y</span>
                                    <span class="n">coroutineScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
                                        <span class="n">lazyListState</span><span class="p">.</span><span class="nf">scrollBy</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>
                                    <span class="p">}</span>
                                    <span class="n">pointY</span> <span class="p">=</span> <span class="n">event</span><span class="p">.</span><span class="n">y</span>
                                    <span class="n">velocityTracker</span><span class="p">.</span><span class="nf">addMovement</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                    <span class="k">if</span> <span class="p">(</span><span class="n">isMove</span><span class="p">.</span><span class="nf">not</span><span class="p">())</span> <span class="p">{</span>
                                        <span class="n">path</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">x</span> <span class="nf">to</span> <span class="p">(</span><span class="n">itemOffset</span><span class="p">[</span><span class="n">lazyListState</span><span class="p">.</span><span class="n">firstVisibleItemIndex</span><span class="p">]</span> <span class="p">+</span> <span class="n">lazyListState</span><span class="p">.</span><span class="n">firstVisibleItemScrollOffset</span><span class="p">)</span> <span class="p">+</span> <span class="n">event</span><span class="p">.</span><span class="n">y</span><span class="p">)</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                            <span class="p">}</span>

                            <span class="nc">MotionEvent</span><span class="p">.</span><span class="nc">ACTION_UP</span> <span class="p">-&gt;</span> <span class="p">{</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">isMove</span><span class="p">.</span><span class="nf">not</span><span class="p">())</span> <span class="p">{</span>
                                    <span class="n">path</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">x</span> <span class="nf">to</span> <span class="p">(</span><span class="n">itemOffset</span><span class="p">[</span><span class="n">lazyListState</span><span class="p">.</span><span class="n">firstVisibleItemIndex</span><span class="p">]</span> <span class="p">+</span> <span class="n">lazyListState</span><span class="p">.</span><span class="n">firstVisibleItemScrollOffset</span><span class="p">)</span> <span class="p">+</span> <span class="n">event</span><span class="p">.</span><span class="n">y</span><span class="p">)</span>
                                    <span class="n">paths</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="nf">toList</span><span class="p">())</span>
                                <span class="p">}</span>
                            <span class="p">}</span>

                            <span class="nc">MotionEvent</span><span class="p">.</span><span class="nc">ACTION_POINTER_UP</span> <span class="p">-&gt;</span> <span class="p">{</span>
                                <span class="n">velocityTracker</span><span class="p">.</span><span class="nf">addMovement</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                                <span class="n">velocityTracker</span><span class="p">.</span><span class="nf">computeCurrentVelocity</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
                                <span class="nf">println</span><span class="p">(</span><span class="n">velocityTracker</span><span class="p">.</span><span class="n">yVelocity</span><span class="p">)</span>
                                <span class="n">animationJob</span> <span class="p">=</span> <span class="n">coroutineScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
                                    <span class="kd">val</span> <span class="py">decayAnimation</span> <span class="p">=</span> <span class="nc">AnimationState</span><span class="p">(</span>
                                        <span class="n">initialValue</span> <span class="p">=</span> <span class="mf">0F</span><span class="p">,</span>
                                        <span class="n">initialVelocity</span> <span class="p">=</span> <span class="n">velocityTracker</span><span class="p">.</span><span class="n">yVelocity</span>
                                    <span class="p">)</span>
                                    <span class="kd">val</span> <span class="py">duration</span> <span class="p">=</span>
                                        <span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">velocityTracker</span><span class="p">.</span><span class="n">yVelocity</span><span class="p">)</span> <span class="p">/</span> <span class="mi">15</span><span class="p">).</span><span class="nf">roundToInt</span><span class="p">()</span>
                                    <span class="k">if</span> <span class="p">(</span><span class="n">duration</span> <span class="p">&lt;</span> <span class="mi">150</span><span class="p">)</span> <span class="k">return</span><span class="nd">@launch</span>

                                    <span class="kd">var</span> <span class="py">lastOffset</span> <span class="p">=</span> <span class="mf">0F</span>
                                    <span class="n">decayAnimation</span><span class="p">.</span><span class="nf">animateTo</span><span class="p">(</span>
                                        <span class="n">velocityTracker</span><span class="p">.</span><span class="n">yVelocity</span><span class="p">,</span>
                                        <span class="n">animationSpec</span> <span class="p">=</span> <span class="nf">tween</span><span class="p">(</span>
                                            <span class="nf">maxOf</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="n">duration</span><span class="p">),</span>
                                            <span class="mi">0</span><span class="p">,</span>
                                            <span class="nc">LinearOutSlowInEasing</span>
                                        <span class="p">)</span>
                                    <span class="p">)</span> <span class="p">{</span>
                                        <span class="kd">val</span> <span class="py">off</span> <span class="p">=</span> <span class="n">lastOffset</span> <span class="p">-</span> <span class="p">(</span><span class="n">decayAnimation</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
                                        <span class="n">coroutineScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
                                            <span class="n">lazyListState</span><span class="p">.</span><span class="nf">scrollBy</span><span class="p">(</span><span class="n">off</span><span class="p">)</span>
                                        <span class="p">}</span>
                                        <span class="n">lastOffset</span> <span class="p">=</span> <span class="n">decayAnimation</span><span class="p">.</span><span class="n">value</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
                        <span class="p">}</span>

                        <span class="k">true</span>
                    <span class="p">},</span>
                <span class="n">state</span> <span class="p">=</span> <span class="n">lazyListState</span><span class="p">,</span>
                <span class="n">userScrollEnabled</span> <span class="p">=</span> <span class="k">false</span>
            <span class="p">)</span> <span class="p">{</span>
                <span class="nf">items</span><span class="p">(</span><span class="n">pages</span><span class="p">.</span><span class="n">size</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nc">Image</span><span class="p">(</span>
                        <span class="n">bitmap</span> <span class="p">=</span> <span class="n">pages</span><span class="p">[</span><span class="n">it</span><span class="p">].</span><span class="nf">asImageBitmap</span><span class="p">(),</span>
                        <span class="n">contentDescription</span> <span class="p">=</span> <span class="s">""</span>
                    <span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="nc">Canvas</span><span class="p">(</span><span class="n">modifier</span> <span class="p">=</span> <span class="nc">Modifier</span>
                <span class="p">.</span><span class="nf">fillMaxSize</span><span class="p">(),</span> <span class="n">onDraw</span> <span class="p">=</span> <span class="p">{</span>
                <span class="n">paths</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">item</span> <span class="p">-&gt;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">size</span> <span class="p">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kd">val</span> <span class="py">offset</span> <span class="p">=</span>
                            <span class="p">(</span><span class="n">itemOffset</span><span class="p">[</span><span class="n">lazyListState</span><span class="p">.</span><span class="n">firstVisibleItemIndex</span><span class="p">]</span> <span class="p">+</span> <span class="n">lazyListState</span><span class="p">.</span><span class="n">firstVisibleItemScrollOffset</span><span class="p">)</span>
                        <span class="kd">val</span> <span class="py">drawPath</span> <span class="p">=</span> <span class="nc">Path</span><span class="p">()</span>
                        <span class="n">drawPath</span><span class="p">.</span><span class="nf">moveTo</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">first</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">second</span> <span class="p">-</span> <span class="n">offset</span><span class="p">)</span>

                        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">1</span> <span class="n">until</span> <span class="n">item</span><span class="p">.</span><span class="n">size</span><span class="p">)</span> <span class="p">{</span>
                            <span class="n">drawPath</span><span class="p">.</span><span class="nf">lineTo</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">first</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">second</span> <span class="p">-</span> <span class="n">offset</span><span class="p">)</span>
                        <span class="p">}</span>
                        <span class="nf">drawPath</span><span class="p">(</span>
                            <span class="n">drawPath</span><span class="p">,</span>
                            <span class="nc">Color</span><span class="p">.</span><span class="nc">Red</span><span class="p">,</span>
                            <span class="n">style</span> <span class="p">=</span> <span class="nc">Stroke</span><span class="p">(</span><span class="n">width</span> <span class="p">=</span> <span class="mf">5F</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">size</span> <span class="p">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">val</span> <span class="py">offset</span> <span class="p">=</span>
                        <span class="p">(</span><span class="n">itemOffset</span><span class="p">[</span><span class="n">lazyListState</span><span class="p">.</span><span class="n">firstVisibleItemIndex</span><span class="p">]</span> <span class="p">+</span> <span class="n">lazyListState</span><span class="p">.</span><span class="n">firstVisibleItemScrollOffset</span><span class="p">)</span>
                    <span class="kd">val</span> <span class="py">drawPath</span> <span class="p">=</span> <span class="nc">Path</span><span class="p">()</span>
                    <span class="n">drawPath</span><span class="p">.</span><span class="nf">moveTo</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">first</span><span class="p">,</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">second</span> <span class="p">-</span> <span class="n">offset</span><span class="p">)</span>

                    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">1</span> <span class="n">until</span> <span class="n">path</span><span class="p">.</span><span class="n">size</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">drawPath</span><span class="p">.</span><span class="nf">lineTo</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">first</span><span class="p">,</span> <span class="n">path</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">second</span> <span class="p">-</span> <span class="n">offset</span><span class="p">)</span>
                    <span class="p">}</span>
                    <span class="nf">drawPath</span><span class="p">(</span>
                        <span class="n">drawPath</span><span class="p">,</span>
                        <span class="nc">Color</span><span class="p">.</span><span class="nc">Red</span><span class="p">,</span>
                        <span class="n">style</span> <span class="p">=</span> <span class="nc">Stroke</span><span class="p">(</span><span class="n">width</span> <span class="p">=</span> <span class="mf">5F</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">}</span>

            <span class="p">})</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<p>使用<code class="language-plaintext highlighter-rouge">compose ui</code>来实现的，底部用<code class="language-plaintext highlighter-rouge">LazyColumn</code>来控制页面的展示，上面一层用<code class="language-plaintext highlighter-rouge">Canvas</code>来展示一下绘制的UI，自定义了手势，因为需要支持双指滑动，单手指是绘画。上面代码写的也比较啰嗦，如果用<code class="language-plaintext highlighter-rouge">pointerInput</code>来实现应该会更简单，主要记录一下<code class="language-plaintext highlighter-rouge">pointerInteropFilter</code>的代码，可以看到和<code class="language-plaintext highlighter-rouge">Android View</code>那套比较接近。</p>

<p>所以如果要直接使用，大概有一部分的优化</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">pointerInteropFilter</code>替换成<code class="language-plaintext highlighter-rouge">pointerInput</code>来实现。</li>
  <li>绘制部分的优化，因为这里是不管显示与否，都进行了轨迹的绘制，不太有必要。</li>
</ul>

<h4 id="写回pdf">
<span class="mr-2">写回PDF</span><a href="#%E5%86%99%E5%9B%9Epdf" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h4>

<div class="language-kotlin highlighter-rouge">
<div class="code-header">
        <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td>
<td class="rouge-code"><pre><span class="kd">val</span> <span class="py">pdfDocument</span> <span class="p">=</span> <span class="nc">PdfDocument</span><span class="p">()</span>

<span class="nf">repeat</span><span class="p">(</span><span class="n">renderer</span><span class="p">.</span><span class="n">pageCount</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">openPage</span> <span class="p">=</span> <span class="n">renderer</span><span class="p">.</span><span class="nf">openPage</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">pageInfo</span> <span class="p">=</span>
        <span class="nc">PdfDocument</span><span class="p">.</span><span class="nc">PageInfo</span><span class="p">.</span><span class="nc">Builder</span><span class="p">(</span><span class="n">openPage</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">openPage</span><span class="p">.</span><span class="n">height</span><span class="p">,</span> <span class="n">it</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">create</span><span class="p">()</span>

    <span class="kd">val</span> <span class="py">page</span> <span class="p">=</span> <span class="n">pdfDocument</span><span class="p">.</span><span class="nf">startPage</span><span class="p">(</span><span class="n">pageInfo</span><span class="p">)</span>

    <span class="kd">val</span> <span class="py">scale</span> <span class="p">=</span> <span class="n">openPage</span><span class="p">.</span><span class="n">width</span><span class="p">.</span><span class="nf">toFloat</span><span class="p">()</span> <span class="p">/</span> <span class="n">screenWidth</span><span class="p">.</span><span class="nf">toFloat</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">canvas</span> <span class="p">=</span> <span class="n">page</span><span class="p">.</span><span class="n">canvas</span>
    <span class="n">canvas</span><span class="p">.</span><span class="nf">scale</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
    <span class="n">canvas</span><span class="p">.</span><span class="nf">drawBitmap</span><span class="p">(</span><span class="n">pages</span><span class="p">[</span><span class="n">it</span><span class="p">],</span> <span class="mf">0F</span><span class="p">,</span> <span class="mf">0F</span><span class="p">,</span> <span class="nc">Paint</span><span class="p">())</span>

    <span class="n">paths</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">item</span> <span class="p">-&gt;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">size</span> <span class="p">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">offset</span> <span class="p">=</span> <span class="p">(</span><span class="n">itemOffset</span><span class="p">[</span><span class="n">it</span><span class="p">])</span>
            <span class="kd">val</span> <span class="py">drawPath</span> <span class="p">=</span> <span class="n">android</span><span class="p">.</span><span class="n">graphics</span><span class="p">.</span><span class="nc">Path</span><span class="p">()</span>
            <span class="n">drawPath</span><span class="p">.</span><span class="nf">moveTo</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">first</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">second</span> <span class="p">-</span> <span class="n">offset</span><span class="p">)</span>

            <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">1</span> <span class="n">until</span> <span class="n">item</span><span class="p">.</span><span class="n">size</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">drawPath</span><span class="p">.</span><span class="nf">lineTo</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">first</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">second</span> <span class="p">-</span> <span class="n">offset</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="n">canvas</span><span class="p">.</span><span class="nf">drawPath</span><span class="p">(</span>
                <span class="n">drawPath</span><span class="p">,</span>
                <span class="nc">Paint</span><span class="p">().</span><span class="nf">apply</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">color</span> <span class="p">=</span> <span class="mh">0xFFFF0000</span><span class="p">.</span><span class="nf">toInt</span><span class="p">()</span>
                    <span class="n">style</span> <span class="p">=</span> <span class="nc">Paint</span><span class="p">.</span><span class="nc">Style</span><span class="p">.</span><span class="nc">STROKE</span>
                    <span class="n">strokeWidth</span> <span class="p">=</span> <span class="mf">5F</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">pdfDocument</span><span class="p">.</span><span class="nf">finishPage</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
    <span class="n">openPage</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
<span class="p">}</span>

<span class="nc">FileOutputStream</span><span class="p">(</span><span class="n">filesDir</span><span class="p">.</span><span class="n">path</span> <span class="p">+</span> <span class="s">"/api_result.pdf"</span><span class="p">).</span><span class="nf">use</span> <span class="p">{</span>
    <span class="n">pdfDocument</span><span class="p">.</span><span class="nf">writeTo</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<p>写回去的代码比较简单，和打开以及<code class="language-plaintext highlighter-rouge">Canvas</code>绘制那部分很像。</p>

<h4 id="小总结">
<span class="mr-2">小总结</span><a href="#%E5%B0%8F%E6%80%BB%E7%BB%93" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h4>

<p>官方的用起来比较方便，但是功能支持很少，不支持密码打开，打开有密码的文件会直接抛出异常</p>

<div class="language-java highlighter-rouge">
<div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td>
<td class="rouge-code"><pre><span class="cm">/**
 * @throws java.io.IOException If an error occurs while reading the file.
 * @throws java.lang.SecurityException If the file requires a password or
 *         the security scheme is not supported.
 */</span>
<span class="kd">public</span> <span class="nf">PdfRenderer</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="nc">ParcelFileDescriptor</span> <span class="n">input</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<p>另外就是文件写入只能使用<code class="language-plaintext highlighter-rouge">canvas</code>，<code class="language-plaintext highlighter-rouge">pdf</code>对拷贝过后，会变的很大，而且失去了文本格式的pdf支持的无损放大能力。</p>

<p><img data-src="../../assets/img/blog/Snipaste_2024-08-01_14-58-57.png" alt="api_result.pdf" data-proofer-ignore></p>

<h3 id="androidpdfviewer">
<span class="mr-2">AndroidPdfViewer</span><a href="#androidpdfviewer" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p><a href="https://github.com/DImuthuUpe/AndroidPdfViewer">DImuthuUpe/AndroidPdfViewer - github</a></p>

<p>这个主要是对<code class="language-plaintext highlighter-rouge">PDF</code>阅读进行支持，支持<code class="language-plaintext highlighter-rouge">pdf</code>的滚动，缩放，以及对内存也有优化，不是一次性加载的。</p>

<pre><code class="language-kts">implementation("com.github.barteksc:android-pdf-viewer:2.8.2")
</code></pre>

<h3 id="itextpdf">
<span class="mr-2">itextpdf</span><a href="#itextpdf" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>对PDF进行写入，这个的<code class="language-plaintext highlighter-rouge">PDF</code>拷贝还会对格式进行优化，使体积更小，也支持PDF的绘制，也是基于<code class="language-plaintext highlighter-rouge">Bitmap</code>的</p>

<pre><code class="language-kts">implementation("com.itextpdf:kernel:8.0.5")
</code></pre>

<div class="language-kotlin highlighter-rouge">
<div class="code-header">
        <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre></td>
<td class="rouge-code"><pre><span class="kd">data class</span> <span class="nc">PathItem</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">positions</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Pair</span><span class="p">&lt;</span><span class="nc">Float</span><span class="p">,</span> <span class="nc">Float</span><span class="p">&gt;&gt;</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">top</span><span class="p">:</span> <span class="nc">Float</span> <span class="p">=</span> <span class="n">positions</span><span class="p">.</span><span class="nf">minOf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">second</span> <span class="p">}</span>
    <span class="kd">val</span> <span class="py">bottom</span><span class="p">:</span> <span class="nc">Float</span> <span class="p">=</span> <span class="n">positions</span><span class="p">.</span><span class="nf">maxOf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">second</span> <span class="p">}</span>
    <span class="kd">val</span> <span class="py">start</span><span class="p">:</span> <span class="nc">Float</span> <span class="p">=</span> <span class="n">positions</span><span class="p">.</span><span class="nf">minOf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">first</span> <span class="p">}</span>
    <span class="kd">val</span> <span class="py">end</span><span class="p">:</span> <span class="nc">Float</span> <span class="p">=</span> <span class="n">positions</span><span class="p">.</span><span class="nf">maxOf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">first</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">write</span><span class="p">(</span><span class="n">basePath</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">disWidth</span><span class="p">:</span> <span class="nc">Float</span><span class="p">,</span> <span class="n">paths</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">PathItem</span><span class="p">&gt;)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">pdfReader</span> <span class="p">=</span> <span class="nc">PdfReader</span><span class="p">(</span><span class="s">"$basePath/api.pdf"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">pdfWriter</span> <span class="p">=</span> <span class="nc">PdfWriter</span><span class="p">(</span><span class="s">"$basePath/api_tmp.pdf"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">pdfDeaderDoc</span> <span class="p">=</span> <span class="nc">PdfDocument</span><span class="p">(</span><span class="n">pdfReader</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">pdfWriterDoc</span> <span class="p">=</span> <span class="nc">PdfDocument</span><span class="p">(</span><span class="n">pdfWriter</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">totalHeight</span> <span class="p">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">..</span><span class="n">pdfDeaderDoc</span><span class="p">.</span><span class="n">numberOfPages</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">pdfPage</span> <span class="p">=</span> <span class="n">pdfDeaderDoc</span><span class="p">.</span><span class="nf">getPage</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">addPage</span> <span class="p">=</span> <span class="n">pdfWriterDoc</span><span class="p">.</span><span class="nf">addNewPage</span><span class="p">()</span>
        <span class="c1">// 页面拷贝</span>
        <span class="kd">val</span> <span class="py">pageCopy</span><span class="p">:</span> <span class="nc">PdfFormXObject</span> <span class="p">=</span> <span class="n">pdfPage</span><span class="p">.</span><span class="nf">copyAsFormXObject</span><span class="p">(</span><span class="n">pdfWriterDoc</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">canvas</span> <span class="p">=</span> <span class="nc">PdfCanvas</span><span class="p">(</span><span class="n">addPage</span><span class="p">)</span>
        <span class="n">canvas</span><span class="p">.</span><span class="nf">addXObject</span><span class="p">(</span><span class="n">pageCopy</span><span class="p">)</span>
        
        <span class="c1">// canvas绘制</span>
        <span class="kd">val</span> <span class="py">pageHeight</span> <span class="p">=</span> <span class="n">pageCopy</span><span class="p">.</span><span class="n">height</span>

        <span class="kd">val</span> <span class="py">scale</span> <span class="p">=</span> <span class="n">pageCopy</span><span class="p">.</span><span class="n">width</span> <span class="p">/</span> <span class="n">disWidth</span>

        <span class="n">canvas</span><span class="p">.</span><span class="nf">setColor</span><span class="p">(</span>
            <span class="nc">Color</span><span class="p">.</span><span class="nf">convertRgbToCmyk</span><span class="p">(</span><span class="nc">DeviceRgb</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
            <span class="k">false</span>
        <span class="p">)</span>
        <span class="n">canvas</span><span class="p">.</span><span class="nf">setLineWidth</span><span class="p">(</span><span class="mf">5F</span> <span class="p">*</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">paths</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">item</span> <span class="p">-&gt;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">bottom</span> <span class="p">*</span> <span class="n">scale</span> <span class="p">-</span> <span class="n">totalHeight</span> <span class="p">&gt;=</span> <span class="mi">0</span> <span class="p">&amp;&amp;</span> <span class="n">item</span><span class="p">.</span><span class="n">top</span> <span class="p">*</span> <span class="n">scale</span> <span class="p">-</span> <span class="n">totalHeight</span> <span class="p">&lt;=</span> <span class="n">pageHeight</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">positions</span><span class="p">.</span><span class="nf">isNotEmpty</span><span class="p">())</span> <span class="p">{</span>
                    <span class="n">canvas</span><span class="p">.</span><span class="nf">moveTo</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">first</span><span class="p">.</span><span class="nf">toDouble</span><span class="p">()</span> <span class="p">*</span> <span class="n">scale</span><span class="p">),</span>
                        <span class="p">(</span><span class="n">pageHeight</span> <span class="p">-</span> <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">second</span> <span class="p">*</span> <span class="n">scale</span> <span class="p">-</span> <span class="n">totalHeight</span><span class="p">))</span>
                    <span class="p">)</span>

                    <span class="k">for</span> <span class="p">(</span><span class="n">y</span> <span class="k">in</span> <span class="mi">1</span> <span class="n">until</span> <span class="n">item</span><span class="p">.</span><span class="n">positions</span><span class="p">.</span><span class="n">size</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">canvas</span><span class="p">.</span><span class="nf">lineTo</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">positions</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">first</span><span class="p">.</span><span class="nf">toDouble</span><span class="p">()</span> <span class="p">*</span> <span class="n">scale</span><span class="p">),</span>
                            <span class="p">(</span><span class="n">pageHeight</span> <span class="p">-</span> <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">positions</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">second</span> <span class="p">*</span> <span class="n">scale</span> <span class="p">-</span> <span class="n">totalHeight</span><span class="p">))</span>
                        <span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">totalHeight</span> <span class="p">+=</span> <span class="n">pageHeight</span>
        <span class="n">canvas</span><span class="p">.</span><span class="nf">stroke</span><span class="p">()</span>
        <span class="n">canvas</span><span class="p">.</span><span class="nf">closePath</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="n">pdfDeaderDoc</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    <span class="n">pdfWriterDoc</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<p><code class="language-plaintext highlighter-rouge">PathItem</code>用来处理不必要绘制的问题，这里<code class="language-plaintext highlighter-rouge">write</code>方法主要也是处理宽高比例，以及缩放，值得注意的是在<code class="language-plaintext highlighter-rouge">itextpdf</code>中坐标系原点为左下角，和一般<code class="language-plaintext highlighter-rouge">canvas</code>中的左上角有出入，需要用高减一下。可以看到体积还缩小了和使用<code class="language-plaintext highlighter-rouge">wps</code>的<code class="language-plaintext highlighter-rouge">pdf</code>优化差不多。</p>

<p><img data-src="../../assets/img/blog/Snipaste_2024-08-01_15-00-37.png.png" alt="api_tmp.pdf" data-proofer-ignore></p>

<p><a href="https://www.cnblogs.com/fonks/p/15090635.htm">IText使用（超详解）</a></p>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  
  <div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i>
    
      <a href="/categories/android/">Android</a>
  </div>
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/tags/pdf/" class="post-tag no-text-decoration">pdf</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=Android+PDF%E7%9A%84%E8%AF%BB%E5%8F%96%E5%92%8C%E5%86%99%E5%85%A5+-+Jiangker&amp;url=http%3A%2F%2F0.0.0.0%3A4000%2Fposts%2Fpdf%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=Android+PDF%E7%9A%84%E8%AF%BB%E5%8F%96%E5%92%8C%E5%86%99%E5%85%A5+-+Jiangker&amp;u=http%3A%2F%2F0.0.0.0%3A4000%2Fposts%2Fpdf%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://t.me/share/url?url=http%3A%2F%2F0.0.0.0%3A4000%2Fposts%2Fpdf%2F&text=Android+PDF%E7%9A%84%E8%AF%BB%E5%8F%96%E5%92%8C%E5%86%99%E5%85%A5+-+Jiangker" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!">
    </i>

  </span>
</div>


  </div>
<!-- .post-tail-bottom -->

</div>
<!-- div.post-tail-wrapper -->


      
    
    

    </div>
  </div> <!-- #core-wrapper -->

  <!-- pannel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">

    <div class="access">
      















  <div id="access-lastmod" class="post">
    <div class="panel-heading">Recently Updated</div>
    <ul class="post-content pl-0 pb-1 ml-1 mt-2">
      
        
        
        
      <li><a href="/posts/open_cv/">OpenCV 图像操作</a></li>
      
        
        
        
      <li><a href="/posts/rustlings/">rustlings 学习和答案</a></li>
      
        
        
        
      <li><a href="/posts/serde_json/">使用serde解析json</a></li>
      
        
        
        
      <li><a href="/posts/zsh/">Ubuntu安装zsh</a></li>
      
        
        
        
      <li><a href="/posts/update_blog/">增加webhooks自动更新blog</a></li>
      
    </ul>
  </div> <!-- #access-lastmod -->



      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/docker/">docker</a>
    
      
      <a class="post-tag" href="/tags/android/">android</a>
    
      
      <a class="post-tag" href="/tags/jetpack/">jetpack</a>
    
      
      <a class="post-tag" href="/tags/raspberrypi/">raspberrypi</a>
    
      
      <a class="post-tag" href="/tags/gitlab/">gitlab</a>
    
      
      <a class="post-tag" href="/tags/actix-web/">actix-web</a>
    
      
      <a class="post-tag" href="/tags/aosp/">AOSP</a>
    
      
      <a class="post-tag" href="/tags/dockerfile/">dockerfile</a>
    
      
      <a class="post-tag" href="/tags/file/">file</a>
    
      
      <a class="post-tag" href="/tags/java/">java</a>
    

    </div>
  </div>


    </div>

    
      
      



<!-- BS-toc.js will be loaded at medium priority -->
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
  <nav id="toc" data-toggle="toc"></nav>
</div>


    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4">
    
      
      <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->





  <div id="related-posts" class="mb-2 mb-sm-4">
    <h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/shared-preferences/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small" data-ts="1653402180" data-df="ll">
  May 24, 2022
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>SharePreferences的基础使用</h3>
            <div class="text-muted small">
              <p>
                





                获取SharedPreferences对象

要想使用SharedPrefernces储存数据，首先要获取SharedPreferences对象。主要获取方式有以下两种

Context类中的getSharedPreferences()方法

//第一个参数为储存的文件名，第二个参数是操作模式，现只有一种
val edit : SharedPreferences = getSharedPre...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/storage-path/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small" data-ts="1653402780" data-df="ll">
  May 24, 2022
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Android文件目录概览</h3>
            <div class="text-muted small">
              <p>
                





                外部储存

可以在手机中直接查看的目录，目录为Android/data/&amp;lt;package name&amp;gt;/xxx 下的系列文件

  传入的参数不要以“/”开始


//主要对应`Android/data/&amp;lt;package name&amp;gt;/files/`下的文件目录,传入空则为根目录
val externalFilesDir = getExternalFilesDir("pl...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/lifecycle/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small" data-ts="1654409220" data-df="ll">
  Jun  5, 2022
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Lifecycle使用以及原理解析</h3>
            <div class="text-muted small">
              <p>
                





                基础使用

在Android框架中定义的许多应用组件都存在着生命周期（例如Activity、Fragment）。组件的生命周期由操作系统中运行的框架代码管理。它们是Android工作原理的核心，应用必须遵守规则，否则会造成内存泄露以及应用的崩溃。应用中有很多组件需要在创建时注册绑定，在可见时运作，在不可见时停止，在销毁时解除绑定，许许多多的操作都与生命周期密切相关。所以这时如果需要添加到生命...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


    
      
      <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/open_cv/" class="btn btn-outline-primary" prompt="Older">
    <p>OpenCV 图像操作</p>
  </a>
  

  
  <div class="btn btn-outline-primary disabled" prompt="Newer">
    <p>-</p>
  </div>
  

</div>

    
      
      <!--  The comments switcher -->


    
  </div>
</div>



        <!-- The Footer -->

<footer class="row pl-3 pr-3">
  <div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0">
    <div class="footer-left">
      <p class="mb-0">
        © 2024
        <a href="https://twitter.com/username">jiangker</a>.
        
        <span data-toggle="tooltip" data-placement="top" title="个人">蜀ICP备2023021215号</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        

        

        Powered by 
          <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
         with 
          <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
         theme.

      </p>
    </div>

  </div>

</footer>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/docker/">docker</a>
    
      
      <a class="post-tag" href="/tags/android/">android</a>
    
      
      <a class="post-tag" href="/tags/jetpack/">jetpack</a>
    
      
      <a class="post-tag" href="/tags/raspberrypi/">raspberrypi</a>
    
      
      <a class="post-tag" href="/tags/gitlab/">gitlab</a>
    
      
      <a class="post-tag" href="/tags/actix-web/">actix-web</a>
    
      
      <a class="post-tag" href="/tags/aosp/">AOSP</a>
    
      
      <a class="post-tag" href="/tags/dockerfile/">dockerfile</a>
    
      
      <a class="post-tag" href="/tags/file/">file</a>
    
      
      <a class="post-tag" href="/tags/java/">java</a>
    

    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    
      <!--
  mermaid-js loader
-->

<script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script>

<script>
  $(function() {
    function updateMermaid(event) {
      if (event.source === window && event.data &&
            event.data.direction === ModeToggle.ID) {

        const mode = event.data.message;

        if (typeof mermaid === "undefined") {
          return;
        }

        let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default");
        let config = { theme: expectedTheme };

        /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */
        $(".mermaid").each(function() {
          let svgCode = $(this).prev().children().html();
          $(this).removeAttr("data-processed");
          $(this).html(svgCode);
        });

        mermaid.initialize(config);
        mermaid.init(undefined, ".mermaid");
      }
    }

    let initTheme = "default";

    if ($("html[data-mode=dark]").length > 0
      || ($("html[data-mode]").length == 0
        && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) {
      initTheme = "dark";
    }

    let mermaidConf = {
      theme: initTheme  /* <default|dark|forest|neutral> */
    };

    /* Markdown converts to HTML */
    $("pre").has("code.language-mermaid").each(function() {
      let svgCode = $(this).children().html();
      $(this).addClass("unloaded");
      $(this).after(`<div class=\"mermaid\">${svgCode}</div>`);
    });

    mermaid.initialize(mermaidConf);

    window.addEventListener("message", updateMermaid);
  });
</script>

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    
      <div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false">
        <div class="toast-header">
          <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="toast-body text-center pt-0">
          <p class="pl-2 pr-2 mb-3">A new version of content is available.</p>
          <button type="button" class="btn btn-primary" aria-label="Update">
            Update
          </button>
        </div>
      </div>
    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No results found.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!--
  JS selector for site.
-->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup & clipboard -->
  

  







  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script>







  

  

  







  
    

    

  



  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script>








<script defer src="/assets/js/dist/post.min.js"></script>


  <!-- MathJax -->
  <script>
  /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */
  MathJax = {
    tex: {
      inlineMath: [              /* start/end delimiter pairs for in-line math */
        ['$','$'],
        ['\\(','\\)']
      ],
      displayMath: [             /* start/end delimiter pairs for display math */
        ['$$', '$$'],
        ['\\[', '\\]']
      ]
    }
  };
  </script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
  </script>


<!-- commons -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script>




  </body>

</html>
