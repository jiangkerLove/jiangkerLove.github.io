<!DOCTYPE html>
<html lang="en">

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Allow having a localized datetime different from the appearance language -->
  

  

    

    

  

  

  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.2.2">
<meta property="og:title" content="rustlings 学习和答案">
<meta name="author" content="jiangker">
<meta property="og:locale" content="en">
<meta name="description" content="前言">
<meta property="og:description" content="前言">
<link rel="canonical" href="http://0.0.0.0:4000/posts/rustlings/">
<meta property="og:url" content="http://0.0.0.0:4000/posts/rustlings/">
<meta property="og:site_name" content="Jiangker">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2024-07-08T16:26:00+08:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="rustlings 学习和答案">
<meta name="twitter:site" content="@twitter_username">
<meta name="twitter:creator" content="@jiangker">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"jiangker"},"dateModified":"2024-07-25T12:34:23+08:00","datePublished":"2024-07-08T16:26:00+08:00","description":"前言","headline":"rustlings 学习和答案","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/posts/rustlings/"},"url":"http://0.0.0.0:4000/posts/rustlings/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>rustlings 学习和答案 | Jiangker
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Jiangker">
<meta name="application-name" content="Jiangker">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  

    
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net">
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&amp;display=swap">

  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/style.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  
    <!--
  Switch the mode between dark and light.
-->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get MODE_ATTR() { return "data-mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }
    static get ID() { return "mode-toggle"; }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      let self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener("change", () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }

          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.notify();

      });

    } /* constructor() */

    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }

    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }

    get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; }

    get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; }

    get hasMode() { return this.mode != null; }

    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage({
        direction: ModeToggle.ID,
        message: this.modeStatus
      }, "*");
    }

  } /* ModeToggle */

  const toggle = new ModeToggle();

  function flipMode() {
    if (toggle.hasMode) {
      if (toggle.isSysDarkPrefer) {
        if (toggle.isLightMode) {
          toggle.clearMode();
        } else {
          toggle.setLight();
        }

      } else {
        if (toggle.isDarkMode) {
          toggle.clearMode();
        } else {
          toggle.setDark();
        }
      }

    } else {
      if (toggle.isSysDarkPrefer) {
        toggle.setLight();
      } else {
        toggle.setDark();
      }
    }

    toggle.notify();

  } /* flipMode() */

</script>

  
</head>


  <body data-spy="scroll" data-target="#toc" data-topbar-visible="true">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" class="mx-auto">
        
          
          <img src="/assets/img/avatar.jpeg" alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">Jiangker</a>
    </div>
    <div class="site-subtitle font-italic">record coding learning</div>

  </div>
<!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">

    
      <button class="mode-toggle btn" aria-label="Switch Mode">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
      <a href="javascript:location.href%20=%20'mailto:'%20+%20%5B'niklaus1996','icloud.com'%5D.join('@')" aria-label="email">
        <i class="fas fa-envelope"></i>
      </a>
      

    

  </div> <!-- .sidebar-bottom -->

</div>
<!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper">
  <div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/">
              Home
            </a>
          </span>

        

      

        

      

        

          
            <span>rustlings 学习和答案</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search...">
    </span>
    <span id="search-cancel">Cancel</span>
  </div>

</div>


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div id="main" class="container pl-xl-4 pr-xl-4">

        









<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4 pb-5">
    <div class="post pl-1 pr-1 pl-md-2 pr-md-2">

    

    
      
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Add attribute 'hide-bullet' to the checkbox list -->



<!-- images -->





<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    

    

  

  
  

  




<!-- Wrap prompt element of blockquote with the <div> tag -->







<!-- return -->





<h1 data-toc-skip>rustlings 学习和答案</h1>

<div class="post-meta text-muted">
    <!-- published date -->
    <span>
      Posted
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="" data-ts="1720427160" data-df="ll" data-toggle="tooltip" data-placement="bottom">
  Jul  8, 2024
</em>

    </span>

    <!-- lastmod date -->
    
    <span>
      Updated
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="" data-ts="1721882063" data-df="ll" data-toggle="tooltip" data-placement="bottom">
  Jul 25, 2024
</em>

    </span>
    

  

  <div class="d-flex justify-content-between">
    <!-- author -->
    <span>
      
      

      

      By

      <em>
        
        jiangker
        
      </em>
    </span>

    <div>
      <!-- page views -->
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom" title="8906 words">
  <em>49 min</em> read</span>

    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <h2 id="前言">
<span class="mr-2">前言</span><a href="#%E5%89%8D%E8%A8%80" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<blockquote>
  <p>去年年中对rust进行了一个大概的学习，然后完成了rustlings的笔记，最后改写了我的两个简单的java项目。今年回首，又感觉比较陌生了，所以准备在此记录一下rustlings的题解和一些笔记。</p>
</blockquote>

<h3 id="相关资料">
<span class="mr-2">相关资料</span><a href="#%E7%9B%B8%E5%85%B3%E8%B5%84%E6%96%99" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<ul>
  <li><a href="https://doc.rust-lang.org/book/">Rust The Book</a></li>
  <li><a href="https://doc.rust-lang.org/rust-by-example/">Rust By Example</a></li>
  <li><a href="https://github.com/rust-lang/rustlings/">rustlings</a></li>
  <li><a href="https://course.rs/about-book.html">Rust Course</a></li>
  <li><a href="https://github.com/jiangkerLove/rustlings">jiangkerLove/rustlings</a></li>
</ul>

<h2 id="intro">
<span class="mr-2">Intro</span><a href="#intro" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<blockquote>
  <p>Rust uses the <code class="language-plaintext highlighter-rouge">print!</code> and <code class="language-plaintext highlighter-rouge">println!</code> macros to print text to the console.</p>
</blockquote>

<h3 id="intro2ts">
<span class="mr-2">intro2.ts</span><a href="#intro2ts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>打印写错了，改为</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="nd">println!</span><span class="p">(</span><span class="s">"Hello world!"</span><span class="p">);</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h4 id="print">
<span class="mr-2">print</span><a href="#print" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h4>

<p>rust的打印是不换行的<code class="language-plaintext highlighter-rouge">print!()</code>以及换行的<code class="language-plaintext highlighter-rouge">println!()</code>，这两个都是宏函数</p>

<h3 id="further-information">
<span class="mr-2">Further information</span><a href="#further-information" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<ul>
  <li><a href="https://doc.rust-lang.org/rust-by-example/hello.html">Hello World</a></li>
  <li><a href="https://doc.rust-lang.org/rust-by-example/hello/print.html">Formatted print</a></li>
</ul>

<h2 id="variables">
<span class="mr-2">Variables</span><a href="#variables" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<blockquote>
  <p>In Rust, variables are immutable by default. When a variable is immutable, once a value is bound to a name, you can’t change that value. You can make them mutable by adding <code class="language-plaintext highlighter-rouge">mut</code> in front of the variable name.</p>
</blockquote>

<h3 id="variables1">
<span class="mr-2">variables1</span><a href="#variables1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>没有声明变量，所以增加<code class="language-plaintext highlighter-rouge">let</code></p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="variables2">
<span class="mr-2">variables2</span><a href="#variables2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>没有指定默认值，这里的变量类型申明是可以省略的。</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="k">let</span> <span class="n">x</span><span class="p">:</span> <span class="nb">i32</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="variables3">
<span class="mr-2">variables3</span><a href="#variables3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>也是没有指定默认值</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="k">let</span> <span class="n">x</span><span class="p">:</span> <span class="nb">i32</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="variables4">
<span class="mr-2">variables4</span><a href="#variables4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>这里涉及到变量的修改，因为rust变量默认是不可变的，所以增加修饰符<code class="language-plaintext highlighter-rouge">mut</code></p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="k">let</span> <span class="k">mut</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="variables5">
<span class="mr-2">variables5</span><a href="#variables5" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>因为这里变量已经赋值并且不可变，而且还是<code class="language-plaintext highlighter-rouge">&amp;str</code>类型，题目也要求不可以对此修改，所以可以考虑利用变量再利用的特性，直接重新申明一次，之前的对象会被回收，不可再使用。</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="k">let</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="variables6">
<span class="mr-2">variables6</span><a href="#variables6" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p><code class="language-plaintext highlighter-rouge">const</code>申明的是编译时确定值的不可变常亮，需要显示的指定类型，所以增加类型即可</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="k">const</span> <span class="n">NUMBER</span><span class="p">:</span> <span class="nb">i32</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="further-information-1">
<span class="mr-2">Further information</span><a href="#further-information-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<ul>
  <li><a href="https://doc.rust-lang.org/book/ch03-01-variables-and-mutability.html">Variables and Mutability</a></li>
</ul>

<h2 id="functions">
<span class="mr-2">Functions</span><a href="#functions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<blockquote>
  <p>Here, you’ll learn how to write functions and how the Rust compiler can help you debug errors even
in more complex code.</p>
</blockquote>

<h3 id="functions1">
<span class="mr-2">functions1</span><a href="#functions1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>这里因为调用了没有申明的函数，所以直接申明就可以了，注意<code class="language-plaintext highlighter-rouge">rust</code>的函数和<code class="language-plaintext highlighter-rouge">c</code>不同，在使用之前或者之后都是OK的</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">call_me</span><span class="p">(){}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="functions2">
<span class="mr-2">functions2</span><a href="#functions2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>方法定义参数是，需要显示的指定参数的类型</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">call_me</span><span class="p">(</span><span class="n">num</span><span class="p">:</span> <span class="nb">i32</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">num</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"Ring! Call number {}"</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="functions3">
<span class="mr-2">functions3</span><a href="#functions3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>对需要参数的方法调用时，必须要指定参数</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="nf">call_me</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="function4">
<span class="mr-2">function4</span><a href="#function4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>有返回值时，需要显示的申明返回值类型。因为这里返回的是if表达式，并且函数的最后一个表达式的值可以被隐式地返回，省略<code class="language-plaintext highlighter-rouge">return</code>关键字，省略分号意味着这个表达式的值将成为函数的返回值。</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">sale_price</span><span class="p">(</span><span class="n">price</span><span class="p">:</span> <span class="nb">i64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">i64</span><span class="p">{</span>
    <span class="k">if</span> <span class="nf">is_even</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">price</span> <span class="o">-</span> <span class="mi">10</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">price</span> <span class="o">-</span> <span class="mi">3</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="function5">
<span class="mr-2">function5</span><a href="#function5" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>同理，这里作为返回值，需要省略分号，增加<code class="language-plaintext highlighter-rouge">return</code>也是不行的。</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">square</span><span class="p">(</span><span class="n">num</span><span class="p">:</span> <span class="nb">i32</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">i32</span> <span class="p">{</span>
    <span class="n">num</span> <span class="o">*</span> <span class="n">num</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="further-information-2">
<span class="mr-2">Further information</span><a href="#further-information-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<ul>
  <li><a href="https://doc.rust-lang.org/book/ch03-03-how-functions-work.html">How Functions Work</a></li>
</ul>

<h2 id="if">
<span class="mr-2">If</span><a href="#if" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">if</code>, the most basic (but still surprisingly versatile!) type of control flow, is what you’ll learn here.</p>
</blockquote>

<h3 id="if1">
<span class="mr-2">if1</span><a href="#if1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>这里主要是写比较逻辑，返回最大值，因为是返回表达式的值，所以都不需要分号</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">bigger</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">i32</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">i32</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">i32</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span> <span class="p">{</span> <span class="n">a</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">b</span> <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="if2">
<span class="mr-2">if2</span><a href="#if2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>这里主要是else if如何使用</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">foo_if_fizz</span><span class="p">(</span><span class="n">fizzish</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">fizzish</span> <span class="o">==</span> <span class="s">"fizz"</span> <span class="p">{</span>
        <span class="s">"foo"</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">fizzish</span> <span class="o">==</span> <span class="s">"fuzz"</span><span class="p">{</span>
        <span class="s">"bar"</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="s">"baz"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="if3">
<span class="mr-2">if3</span><a href="#if3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p><code class="language-plaintext highlighter-rouge">if</code>表达式的所有分支必须返回相同类型的值.</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">animal_habitat</span><span class="p">(</span><span class="n">animal</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="p">{</span>
    <span class="c1">// TODO: Fix the compiler error in the statement below.</span>
    <span class="k">let</span> <span class="n">identifier</span> <span class="o">=</span> <span class="k">if</span> <span class="n">animal</span> <span class="o">==</span> <span class="s">"crab"</span> <span class="p">{</span>
        <span class="mi">1</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">animal</span> <span class="o">==</span> <span class="s">"gopher"</span> <span class="p">{</span>
        <span class="mi">2</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">animal</span> <span class="o">==</span> <span class="s">"snake"</span> <span class="p">{</span>
        <span class="mi">3</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="mi">4</span>
    <span class="p">};</span>

    <span class="c1">// Don't change the expression below!</span>
    <span class="k">if</span> <span class="n">identifier</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">{</span>
        <span class="s">"Beach"</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">identifier</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">{</span>
        <span class="s">"Burrow"</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">identifier</span> <span class="o">==</span> <span class="mi">3</span> <span class="p">{</span>
        <span class="s">"Desert"</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="s">"Unknown"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="further-information-3">
<span class="mr-2">Further information</span><a href="#further-information-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<ul>
  <li><a href="https://doc.rust-lang.org/book/ch03-05-control-flow.html#if-expressions">Control Flow - if expressions</a></li>
</ul>

<h3 id="quiz1">
<span class="mr-2">quiz1</span><a href="#quiz1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>这是前面一部分的总结，需要定义一个方法满足条件</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">calculate_price_of_apples</span><span class="p">(</span><span class="n">num</span><span class="p">:</span> <span class="nb">i32</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">i32</span> <span class="p">{</span> <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;=</span> <span class="mi">40</span> <span class="p">{</span> <span class="n">num</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">num</span> <span class="p">}</span> <span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h2 id="primitive-types">
<span class="mr-2">Primitive Types</span><a href="#primitive-types" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<blockquote>
  <p>Rust has a couple of basic types that are directly implemented into the compiler. In this section, we’ll go through the most important ones.</p>
</blockquote>

<h3 id="primitive_types1">
<span class="mr-2">primitive_types1</span><a href="#primitive_types1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>需要定义一个新的完整变量</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td>
<td class="rouge-code"><pre><span class="k">let</span> <span class="n">is_evening</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
<span class="k">if</span> <span class="n">is_evening</span> <span class="p">{</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"Good evening!"</span><span class="p">);</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="primitive_types2">
<span class="mr-2">primitive_types2</span><a href="#primitive_types2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>也是定义一个变量，随意就行</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="k">let</span> <span class="n">your_character</span> <span class="o">=</span> <span class="sc">'1'</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="primitive_types3">
<span class="mr-2">primitive_types3</span><a href="#primitive_types3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>定义一个长度超过100的arr</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="k">let</span> <span class="n">a</span> <span class="o">=</span> <span class="s">"12345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890"</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="primitive_types4">
<span class="mr-2">primitive_types4</span><a href="#primitive_types4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>这里需要从原来的数组中获取一个片段出来</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="k">let</span> <span class="n">nice_slice</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">4</span><span class="p">];</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<p>注意这里用到了<code class="language-plaintext highlighter-rouge">&amp;</code>符号，表示这是创建一个引用出来，指向的是原来的片段；</p>

<p>可能有人要问了，为什么要在数组或向量的切片操作中使用&amp;符号呢？这是因为：</p>

<ul>
  <li>
    <p>借用数据： Rust 中的切片操作返回的类型是一个引用，而不是数据本身。这意味着切片并不会拷贝整个数据，而只是提供了一个指向原始数据特定部分的引用。这种做法可以避免不必要的内存分配和数据复制。</p>
  </li>
  <li>
    <p>所有权和借用规则： Rust的所有权系统要求在操作数据时要么拥有数据的所有权，要么借用数据的引用。使用&amp;符号创建的切片引用，表明我们只是借用了原始数据的一部分，而不是拥有整个数据。</p>
  </li>
  <li>
    <p>性能和内存： 借用数据比复制数据更高效，特别是当处理大量数据时。通过使用引用，可以避免在堆上分配新的内存空间，从而提高程序的性能和内存效率。</p>
  </li>
</ul>

<p>那么还有人要问了，能不能写成拷贝的形式呢 ? 那就得比较麻烦一点了，需要先创建数组，然后再拷贝过去。</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td>
<td class="rouge-code"><pre><span class="k">let</span> <span class="k">mut</span> <span class="n">nice_slice</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">;</span> <span class="mi">3</span><span class="p">];</span>

<span class="k">let</span> <span class="n">slice</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">4</span><span class="p">];</span>
<span class="n">nice_slice</span><span class="nf">.copy_from_slice</span><span class="p">(</span><span class="n">slice</span><span class="p">);</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="primitive_types5">
<span class="mr-2">primitive_types5</span><a href="#primitive_types5" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>解构提取元祖的数据</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="k">let</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="o">=</span> <span class="n">cat</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<p>这里可以看到编译器提示类型，但是类型不能写到里面，得写到后面</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="k">let</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span> <span class="p">(</span><span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="nb">f32</span><span class="p">)</span> <span class="o">=</span> <span class="n">cat</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="primitive_types6">
<span class="mr-2">primitive_types6</span><a href="#primitive_types6" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>解构获取元祖中的某一个元素。</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="k">let</span> <span class="n">second</span><span class="p">:</span> <span class="nb">i32</span> <span class="o">=</span> <span class="n">numbers</span><span class="na">.1</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="further-information-4">
<span class="mr-2">Further information</span><a href="#further-information-4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<ul>
  <li><a href="https://doc.rust-lang.org/stable/book/ch03-02-data-types.html">Data Types</a></li>
  <li><a href="https://doc.rust-lang.org/stable/book/ch04-03-slices.html">The Slice Type</a></li>
</ul>

<h2 id="vectors">
<span class="mr-2">Vectors</span><a href="#vectors" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<blockquote>
  <p>Vectors are one of the most-used Rust data structures. In other programming
languages, they’d simply be called Arrays, but since Rust operates on a
bit of a lower level, an array in Rust is stored on the stack (meaning it
can’t grow or shrink, and the size needs to be known at compile time),
and a Vector is stored in the heap (where these restrictions do not apply).
Vectors are a bit of a later chapter in the book, but we think that they’re
useful enough to talk about them a bit earlier. We shall be talking about
the other useful data structure, hash maps, later.</p>
</blockquote>

<h3 id="vecs1">
<span class="mr-2">vecs1</span><a href="#vecs1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>这里规定了返回值类型，需要把Array转换成Vec</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">array_and_vec</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="p">([</span><span class="nb">i32</span><span class="p">;</span> <span class="mi">4</span><span class="p">],</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">i32</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">];</span> <span class="c1">// Array</span>

    <span class="k">let</span> <span class="n">v</span> <span class="o">=</span> <span class="n">a</span><span class="nf">.to_vec</span><span class="p">();</span>

    <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="vecs2">
<span class="mr-2">vecs2</span><a href="#vecs2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>观察单测，可以发现其实都是想返回乘2之后的数据，关键就在怎么写，其中还给了一个例子，可以参考</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">vec_loop</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="nb">i32</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">i32</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">output</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>

    <span class="k">for</span> <span class="n">element</span> <span class="k">in</span> <span class="n">input</span> <span class="p">{</span>
        <span class="n">output</span><span class="nf">.push</span><span class="p">(</span><span class="n">element</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">output</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">vec_map</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="nb">i32</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">i32</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">input</span>
        <span class="nf">.iter</span><span class="p">()</span>
        <span class="nf">.map</span><span class="p">(|</span><span class="n">element</span><span class="p">|</span> <span class="p">{</span>
            <span class="n">element</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="p">})</span>
        <span class="nf">.collect</span><span class="p">()</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="further-information-5">
<span class="mr-2">Further information</span><a href="#further-information-5" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<ul>
  <li><a href="https://doc.rust-lang.org/stable/book/ch08-01-vectors.html">Storing Lists of Values with Vectors</a></li>
  <li><a href="https://doc.rust-lang.org/std/primitive.slice.html#method.iter_mut"><code class="language-plaintext highlighter-rouge">iter_mut</code></a></li>
  <li><a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.map"><code class="language-plaintext highlighter-rouge">map</code></a></li>
</ul>

<h2 id="move-semantics">
<span class="mr-2">Move Semantics</span><a href="#move-semantics" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<blockquote>
  <p>These exercises are adapted from <a href="https://github.com/pnkfelix">pnkfelix</a>’s <a href="https://pnkfelix.github.io/rust-examples-icfp2014/">Rust Tutorial</a> – Thank you Felix!!!</p>
</blockquote>

<h3 id="move_semantics1">
<span class="mr-2">move_semantics1</span><a href="#move_semantics1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>这里主要是传入的是不可变对象，然后需要向其添加元素，所以需要进行所有权转换</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">fill_vec</span><span class="p">(</span><span class="n">vec</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">i32</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">i32</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">vec</span> <span class="o">=</span> <span class="n">vec</span><span class="p">;</span>

    <span class="n">vec</span><span class="nf">.push</span><span class="p">(</span><span class="mi">88</span><span class="p">);</span>

    <span class="n">vec</span>
<span class="p">}</span>

<span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">move_semantics1</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">vec0</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">66</span><span class="p">];</span>
        <span class="k">let</span> <span class="n">vec1</span> <span class="o">=</span> <span class="nf">fill_vec</span><span class="p">(</span><span class="n">vec0</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="nd">vec!</span><span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">88</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<p>在这里<code class="language-plaintext highlighter-rouge">vec0</code>已经把所有权传给了<code class="language-plaintext highlighter-rouge">fill_vec</code>方法，后续就不能再继续使用了，然后看看<code class="language-plaintext highlighter-rouge">fill_vec</code>函数的作用</p>

<p>在 Rust 中，函数参数的传递有两种方式：按值传递（move）和按引用传递（borrow）。</p>

<p><strong>按值传递（move）</strong>
在 Rust 中，对于不可变的数据结构（比如基本数据类型和不可变引用），函数参数默认是按值传递的。这意味着当你调用函数时，函数会获取参数的所有权，也就是将参数的所有权转移给函数，称为 move。在函数内部对参数的修改不会影响原始的数据。</p>

<p><strong>解释 fill_vec 函数的行为：</strong></p>

<ol>
  <li>参数传递：<code class="language-plaintext highlighter-rouge">fn fill_vec(vec: Vec&lt;i32&gt;) -&gt; Vec&lt;i32&gt;</code> 定义了一个函数 <code class="language-plaintext highlighter-rouge">fill_vec</code>，它接收一个 <code class="language-plaintext highlighter-rouge">Vec&lt;i32&gt;</code> 类型的参数 <code class="language-plaintext highlighter-rouge">vec</code>。这里的 <code class="language-plaintext highlighter-rouge">vec</code> 是按值传递的，即函数调用时会发生所有权的转移。</li>
  <li>函数内部操作：<code class="language-plaintext highlighter-rouge">let mut vec = vec;</code> 在函数内部，通过 <code class="language-plaintext highlighter-rouge">let mut vec = vec;</code> 将参数 <code class="language-plaintext highlighter-rouge">vec</code> 的所有权转移给了函数内部的新变量 <code class="language-plaintext highlighter-rouge">vec</code>。这一步实际上是一个 <code class="language-plaintext highlighter-rouge">move</code> 操作，导致原始的 <code class="language-plaintext highlighter-rouge">vec</code> 参数被移动（所有权被转移），在函数返回后不再有效。</li>
  <li>修改操作：<code class="language-plaintext highlighter-rouge">vec.push(88);</code> 在函数内部，通过 <code class="language-plaintext highlighter-rouge">vec.push(88);</code> 向 <code class="language-plaintext highlighter-rouge">vec</code> 中添加了一个新元素 88。</li>
  <li>返回值：<code class="language-plaintext highlighter-rouge">vec</code> 在函数末尾作为返回值返回给调用者。由于 <code class="language-plaintext highlighter-rouge">Rust</code> 中的函数返回值可以传递所有权，因此返回的 <code class="language-plaintext highlighter-rouge">vec</code> 将成为函数调用者所拥有的新的 <code class="language-plaintext highlighter-rouge">Vec&lt;i32&gt;</code>。</li>
</ol>

<h3 id="move_semantics2">
<span class="mr-2">move_semantics2</span><a href="#move_semantics2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>这第二个例子就是解决所有权转移后<code class="language-plaintext highlighter-rouge">vec0</code>不再可用的</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td>
<td class="rouge-code"><pre><span class="nd">#[test]</span>
<span class="k">fn</span> <span class="nf">move_semantics2</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">vec0</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">66</span><span class="p">];</span>

    <span class="k">let</span> <span class="n">vec1</span> <span class="o">=</span> <span class="nf">fill_vec</span><span class="p">(</span><span class="n">vec0</span><span class="nf">.clone</span><span class="p">());</span>

    <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">vec0</span><span class="p">,</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">66</span><span class="p">]);</span>
    <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">88</span><span class="p">]);</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="move_semantics3">
<span class="mr-2">move_semantics3</span><a href="#move_semantics3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>因为前面的在<code class="language-plaintext highlighter-rouge">fill_vec</code>中都进行了额外的所有权转移，这个例子就是来解释怎么优化这块的，可以考虑直接声明为可变动，那后续里面就可以直接操作了</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">fill_vec</span><span class="p">(</span><span class="k">mut</span> <span class="n">vec</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">i32</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">i32</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">vec</span><span class="nf">.push</span><span class="p">(</span><span class="mi">88</span><span class="p">);</span>

    <span class="n">vec</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="move_semantics4">
<span class="mr-2">move_semantics4</span><a href="#move_semantics4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>因为x连续进行了两次借用，所以第二次借用会出现错误。所以可以考虑先对y进行使用，当y后续没有使用归还了x之后，z就可以继续借用x了。</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td>
<td class="rouge-code"><pre><span class="nd">#[test]</span>
<span class="k">fn</span> <span class="nf">move_semantics4</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">y</span> <span class="o">=</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">x</span><span class="p">;</span>
    <span class="o">*</span><span class="n">y</span> <span class="o">+=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">z</span> <span class="o">=</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">x</span><span class="p">;</span>
    <span class="o">*</span><span class="n">z</span> <span class="o">+=</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1200</span><span class="p">);</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="move_semantics5">
<span class="mr-2">move_semantics5</span><a href="#move_semantics5" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p><code class="language-plaintext highlighter-rouge">get_char</code>不获取所有权，只获取值，不影响原来的值；<code class="language-plaintext highlighter-rouge">string_uppercase</code>获取所有权，进行转换，影响原来的值。</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="s">"Rust is great!"</span><span class="nf">.to_string</span><span class="p">();</span>

    <span class="nf">get_char</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">);</span>

    <span class="nf">string_uppercase</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Shouldn't take ownership</span>
<span class="k">fn</span> <span class="nf">get_char</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">String</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">char</span> <span class="p">{</span>
    <span class="n">data</span><span class="nf">.chars</span><span class="p">()</span><span class="nf">.last</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// Should take ownership</span>
<span class="k">fn</span> <span class="nf">string_uppercase</span><span class="p">(</span><span class="k">mut</span> <span class="n">data</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="nf">.to_uppercase</span><span class="p">();</span>

    <span class="nd">println!</span><span class="p">(</span><span class="s">"{data}"</span><span class="p">);</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="further-information-6">
<span class="mr-2">Further information</span><a href="#further-information-6" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>For this section, the book links are especially important.</p>

<ul>
  <li><a href="https://doc.rust-lang.org/book/ch04-01-what-is-ownership.html">Ownership</a></li>
  <li><a href="https://doc.rust-lang.org/book/ch04-02-references-and-borrowing.html">Reference and borrowing</a></li>
</ul>

<h2 id="structs">
<span class="mr-2">Structs</span><a href="#structs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<blockquote>
  <p>Rust has three struct types: a classic C struct, a tuple struct, and a unit struct.</p>
</blockquote>

<h3 id="structs1">
<span class="mr-2">structs1</span><a href="#structs1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>这里主要表示常规结构体和元祖结构体的定义和使用，注意常规结构体都需要写字段名。</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td>
<td class="rouge-code"><pre><span class="k">struct</span> <span class="n">ColorRegularStruct</span> <span class="p">{</span>
    <span class="n">red</span><span class="p">:</span> <span class="nb">i32</span><span class="p">,</span>
    <span class="n">green</span><span class="p">:</span> <span class="nb">i32</span><span class="p">,</span>
    <span class="n">blue</span><span class="p">:</span> <span class="nb">i32</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="nf">ColorTupleStruct</span><span class="p">(</span><span class="nb">i32</span><span class="p">,</span> <span class="nb">i32</span><span class="p">,</span> <span class="nb">i32</span><span class="p">);</span>

<span class="nd">#[derive(Debug)]</span>
<span class="k">struct</span> <span class="n">UnitStruct</span><span class="p">;</span>

<span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">regular_structs</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">green</span> <span class="o">=</span> <span class="n">ColorRegularStruct</span> <span class="p">{</span> <span class="n">red</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span> <span class="mi">255</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span> <span class="mi">0</span> <span class="p">};</span>

        <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">green</span><span class="py">.red</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">green</span><span class="py">.green</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">green</span><span class="py">.blue</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">tuple_structs</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">green</span> <span class="o">=</span> <span class="nf">ColorTupleStruct</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

        <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">green</span><span class="na">.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">green</span><span class="na">.1</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">green</span><span class="na">.2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">unit_structs</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">unit_struct</span> <span class="o">=</span> <span class="n">UnitStruct</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">message</span> <span class="o">=</span> <span class="nd">format!</span><span class="p">(</span><span class="s">"{unit_struct:?}s are fun!"</span><span class="p">);</span>

        <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s">"UnitStructs are fun!"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">#[derive(Debug)]</code>：这行代码为结构体自动实现了<code class="language-plaintext highlighter-rouge">Debug trait</code>，使其可以使用<code class="language-plaintext highlighter-rouge">:?</code>进行格式化输出。</li>
  <li>
<code class="language-plaintext highlighter-rouge">{unit_struct:?}：</code>花括号内的 <code class="language-plaintext highlighter-rouge">:?</code> 是一种格式化标记，表示使用 <code class="language-plaintext highlighter-rouge">Debug trait</code> 来打印 <code class="language-plaintext highlighter-rouge">unit_struct</code> 的调试信息。</li>
</ul>

<h3 id="structs2">
<span class="mr-2">structs2</span><a href="#structs2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>创建一下自己的结构体，满足结果判断就行</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td>
<td class="rouge-code"><pre><span class="k">let</span> <span class="n">your_order</span> <span class="o">=</span> <span class="n">Order</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"Hacker in Rust"</span><span class="p">),</span>
    <span class="n">year</span><span class="p">:</span> <span class="mi">2019</span><span class="p">,</span>
    <span class="n">made_by_phone</span><span class="p">:</span> <span class="k">false</span><span class="p">,</span>
    <span class="n">made_by_mobile</span><span class="p">:</span> <span class="k">false</span><span class="p">,</span>
    <span class="n">made_by_email</span><span class="p">:</span> <span class="k">true</span><span class="p">,</span>
    <span class="n">item_number</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
    <span class="n">count</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="structs3">
<span class="mr-2">structs3</span><a href="#structs3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>这里是给结构体增加方法，和常规定义方法类似。</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td>
<td class="rouge-code"><pre><span class="nd">#[derive(Debug)]</span>
<span class="k">struct</span> <span class="n">Package</span> <span class="p">{</span>
    <span class="n">sender_country</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="n">recipient_country</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="n">weight_in_grams</span><span class="p">:</span> <span class="nb">u32</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">Package</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">sender_country</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">recipient_country</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">weight_in_grams</span><span class="p">:</span> <span class="nb">u32</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">weight_in_grams</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="p">{</span>
            <span class="nd">panic!</span><span class="p">(</span><span class="s">"Can't ship a package with weight below 10 grams"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">Self</span> <span class="p">{</span>
            <span class="n">sender_country</span><span class="p">,</span>
            <span class="n">recipient_country</span><span class="p">,</span>
            <span class="n">weight_in_grams</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">is_international</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
        <span class="k">self</span><span class="py">.sender_country</span> <span class="o">!=</span> <span class="k">self</span><span class="py">.recipient_country</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">get_fees</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">cents_per_gram</span><span class="p">:</span> <span class="nb">u32</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">u32</span> <span class="p">{</span>
        <span class="n">cents_per_gram</span> <span class="o">*</span> <span class="k">self</span><span class="py">.weight_in_grams</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="nd">#[should_panic]</span>
    <span class="k">fn</span> <span class="nf">fail_creating_weightless_package</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">sender_country</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"Spain"</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">recipient_country</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"Austria"</span><span class="p">);</span>

        <span class="nn">Package</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">sender_country</span><span class="p">,</span> <span class="n">recipient_country</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<ul>
  <li>需要注意返回不能用<code class="language-plaintext highlighter-rouge">return</code>以及<code class="language-plaintext highlighter-rouge">;</code>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">#[should_panic]</code> 表示期望有异常，所以会打印出报错日志，但是这测试是通过的</li>
  <li>
<code class="language-plaintext highlighter-rouge">::</code> 用于命名空间（模块）访问、调用关联函数和常量，以及泛型和特征的约束。</li>
  <li>
<code class="language-plaintext highlighter-rouge">.</code> 用于访问结构体或枚举的字段和方法，以及调用对象实例的方法。
    <h3 id="further-information-7">
<span class="mr-2">Further information</span><a href="#further-information-7" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>
  </li>
  <li><a href="https://doc.rust-lang.org/book/ch05-01-defining-structs.html">Structures</a></li>
  <li><a href="https://doc.rust-lang.org/book/ch05-03-method-syntax.html">Method Syntax</a></li>
</ul>

<h2 id="enums">
<span class="mr-2">Enums</span><a href="#enums" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<blockquote>
  <p>Rust allows you to define types called “enums” which enumerate possible values.
Enums are a feature in many languages, but their capabilities differ in each language. Rust’s enums are most similar to algebraic data types in functional languages, such as F#, OCaml, and Haskell.
Useful in combination with enums is Rust’s “pattern matching” facility, which makes it easy to run different code for different values of an enumeration.</p>
</blockquote>

<h3 id="enums1">
<span class="mr-2">enums1</span><a href="#enums1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>定义一个没有参数的枚举</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td>
<td class="rouge-code"><pre><span class="nd">#[derive(Debug)]</span>
<span class="k">enum</span> <span class="n">Message</span> <span class="p">{</span>
    <span class="n">Resize</span><span class="p">,</span>
    <span class="n">Move</span><span class="p">,</span>
    <span class="n">Echo</span><span class="p">,</span>
    <span class="n">ChangeColor</span><span class="p">,</span>
    <span class="n">Quit</span><span class="p">,</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="enums2">
<span class="mr-2">enums2</span><a href="#enums2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>丰富的枚举类型支持，可以支持结构体，元祖等混合使用.</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td>
<td class="rouge-code"><pre><span class="nd">#[derive(Debug)]</span>
<span class="k">enum</span> <span class="n">Message</span> <span class="p">{</span>
    <span class="c1">// TODO: Define the different variants used below.</span>
    <span class="n">Resize</span> <span class="p">{</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">i32</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">i32</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nf">Move</span><span class="p">(</span><span class="n">Point</span><span class="p">),</span>
    <span class="nf">Echo</span><span class="p">(</span><span class="nb">String</span><span class="p">),</span>
    <span class="nf">ChangeColor</span><span class="p">(</span><span class="nb">i32</span><span class="p">,</span> <span class="nb">i32</span><span class="p">,</span> <span class="nb">i32</span><span class="p">),</span>
    <span class="n">Quit</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="enums3">
<span class="mr-2">enums3</span><a href="#enums3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>主要就是枚举的<code class="language-plaintext highlighter-rouge">match</code>操作，类似于<code class="language-plaintext highlighter-rouge">kotlin</code>的<code class="language-plaintext highlighter-rouge">when</code>，不需要使用<code class="language-plaintext highlighter-rouge">break</code></p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre></td>
<td class="rouge-code"><pre><span class="k">struct</span> <span class="n">Point</span> <span class="p">{</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">u64</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">u64</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">enum</span> <span class="n">Message</span> <span class="p">{</span>
    <span class="n">Resize</span> <span class="p">{</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">u64</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">u64</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nf">Move</span><span class="p">(</span><span class="n">Point</span><span class="p">),</span>
    <span class="nf">Echo</span><span class="p">(</span><span class="nb">String</span><span class="p">),</span>
    <span class="nf">ChangeColor</span><span class="p">(</span><span class="nb">u8</span><span class="p">,</span> <span class="nb">u8</span><span class="p">,</span> <span class="nb">u8</span><span class="p">),</span>
    <span class="n">Quit</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">State</span> <span class="p">{</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">u64</span><span class="p">,</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">u64</span><span class="p">,</span>
    <span class="n">position</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span>
    <span class="n">message</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="n">color</span><span class="p">:</span> <span class="p">(</span><span class="nb">u8</span><span class="p">,</span> <span class="nb">u8</span><span class="p">,</span> <span class="nb">u8</span><span class="p">),</span>
    <span class="n">quit</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">State</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">resize</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">u64</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">u64</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="py">.width</span> <span class="o">=</span> <span class="n">width</span><span class="p">;</span>
        <span class="k">self</span><span class="py">.height</span> <span class="o">=</span> <span class="n">height</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">move_position</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="py">.position</span> <span class="o">=</span> <span class="n">point</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">echo</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="py">.message</span> <span class="o">=</span> <span class="n">s</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">change_color</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">,</span> <span class="n">red</span><span class="p">:</span> <span class="nb">u8</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span> <span class="nb">u8</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span> <span class="nb">u8</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="py">.color</span> <span class="o">=</span> <span class="p">(</span><span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">quit</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="py">.quit</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">process</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// TODO: Create a match expression to process the different message</span>
        <span class="c1">// variants using the methods defined above.</span>
        <span class="k">match</span> <span class="n">message</span> <span class="p">{</span>
            <span class="nn">Message</span><span class="p">::</span><span class="n">Resize</span> <span class="p">{</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="p">}</span> <span class="k">=&gt;</span> <span class="p">{</span>
                <span class="k">self</span><span class="nf">.resize</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="nn">Message</span><span class="p">::</span><span class="nf">Move</span><span class="p">(</span><span class="n">point</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span> <span class="k">self</span><span class="nf">.move_position</span><span class="p">(</span><span class="n">point</span><span class="p">)</span> <span class="p">}</span>
            <span class="nn">Message</span><span class="p">::</span><span class="nf">Echo</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span> <span class="k">self</span><span class="nf">.echo</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="p">}</span>
            <span class="nn">Message</span><span class="p">::</span><span class="nf">ChangeColor</span><span class="p">(</span><span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span> <span class="k">self</span><span class="nf">.change_color</span><span class="p">(</span><span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span><span class="p">)</span> <span class="p">}</span>
            <span class="nn">Message</span><span class="p">::</span><span class="n">Quit</span> <span class="k">=&gt;</span> <span class="p">{</span> <span class="k">self</span><span class="nf">.quit</span><span class="p">()</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="further-information-8">
<span class="mr-2">Further information</span><a href="#further-information-8" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<ul>
  <li><a href="https://doc.rust-lang.org/book/ch06-00-enums.html">Enums</a></li>
  <li><a href="https://doc.rust-lang.org/book/ch18-03-pattern-syntax.html">Pattern syntax</a></li>
</ul>

<h2 id="strings">
<span class="mr-2">Strings</span><a href="#strings" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<blockquote>
  <p>Rust has two string types, a string slice (<code class="language-plaintext highlighter-rouge">&amp;str</code>) and an owned string (<code class="language-plaintext highlighter-rouge">String</code>).
We’re not going to dictate when you should use which one, but we’ll show you how to identify and create them, as well as use them.</p>
</blockquote>

<h3 id="strings1">
<span class="mr-2">strings1</span><a href="#strings1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>需要返回String，而不是<code class="language-plaintext highlighter-rouge">&amp;str</code></p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">current_favorite_color</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"blue"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<ul>
  <li>字符串字面量 <code class="language-plaintext highlighter-rouge">&amp;'str</code> 是字符串字面量，它是一个指向程序数据段中某个位置的不可变引用，具有 <code class="language-plaintext highlighter-rouge">'static</code> 生命周期。</li>
  <li>
<code class="language-plaintext highlighter-rouge">String</code> 类型：<code class="language-plaintext highlighter-rouge">String</code> 是一个堆分配的字符串类型，提供了更多的功能和灵活性。</li>
</ul>

<h3 id="strings2">
<span class="mr-2">strings2</span><a href="#strings2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>这里主要考查<code class="language-plaintext highlighter-rouge">String</code>转<code class="language-plaintext highlighter-rouge">&amp;str</code></p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">is_a_color_word</span><span class="p">(</span><span class="n">attempt</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
    <span class="n">attempt</span> <span class="o">==</span> <span class="s">"green"</span> <span class="p">||</span> <span class="n">attempt</span> <span class="o">==</span> <span class="s">"blue"</span> <span class="p">||</span> <span class="n">attempt</span> <span class="o">==</span> <span class="s">"red"</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">word</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"green"</span><span class="p">);</span> <span class="c1">// Don't change this line.</span>

    <span class="k">if</span> <span class="nf">is_a_color_word</span><span class="p">(</span><span class="o">&amp;</span><span class="n">word</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"That is a color word I know!"</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"That is not a color word I know."</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<p>因为不涉及改变，直接借用就行了，也可以使用<code class="language-plaintext highlighter-rouge">as_str()</code>方法</p>

<h3 id="string3">
<span class="mr-2">string3</span><a href="#string3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>字符串的一些操作</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">trim_me</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="p">{</span>
    <span class="n">input</span><span class="nf">.trim</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">compose_me</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="nd">format!</span><span class="p">(</span><span class="s">"{} world!"</span><span class="p">,</span> <span class="n">input</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">replace_me</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="n">input</span><span class="nf">.replace</span><span class="p">(</span><span class="s">"cars"</span><span class="p">,</span><span class="s">"balloons"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="string4">
<span class="mr-2">string4</span><a href="#string4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>也是字符串的操作，多种情况的返回值</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nf">string_slice</span><span class="p">(</span><span class="s">"blue"</span><span class="p">);</span>

    <span class="nf">string</span><span class="p">(</span><span class="s">"red"</span><span class="nf">.to_string</span><span class="p">());</span>

    <span class="nf">string</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"hi"</span><span class="p">));</span>

    <span class="nf">string</span><span class="p">(</span><span class="s">"rust is fun!"</span><span class="nf">.to_owned</span><span class="p">());</span>

    <span class="nf">string</span><span class="p">(</span><span class="s">"nice weather"</span><span class="nf">.into</span><span class="p">());</span>

    <span class="nf">string</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Interpolation {}"</span><span class="p">,</span> <span class="s">"Station"</span><span class="p">));</span>

    <span class="c1">// WARNING: This is byte indexing, not character indexing.</span>
    <span class="c1">// Character indexing can be done using `s.chars().nth(INDEX)`.</span>
    <span class="nf">string_slice</span><span class="p">(</span><span class="o">&amp;</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"abc"</span><span class="p">)[</span><span class="mi">0</span><span class="o">..</span><span class="mi">1</span><span class="p">]);</span>

    <span class="nf">string_slice</span><span class="p">(</span><span class="s">"  hello there "</span><span class="nf">.trim</span><span class="p">());</span>

    <span class="nf">string</span><span class="p">(</span><span class="s">"Happy Monday!"</span><span class="nf">.replace</span><span class="p">(</span><span class="s">"Mon"</span><span class="p">,</span> <span class="s">"Tues"</span><span class="p">));</span>

    <span class="nf">string</span><span class="p">(</span><span class="s">"mY sHiFt KeY iS sTiCkY"</span><span class="nf">.to_lowercase</span><span class="p">());</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="further-information-9">
<span class="mr-2">Further information</span><a href="#further-information-9" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<ul>
  <li><a href="https://doc.rust-lang.org/book/ch08-02-strings.html">Strings</a></li>
</ul>

<h2 id="modules">
<span class="mr-2">Modules</span><a href="#modules" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<blockquote>
  <p>In this section we’ll give you an introduction to Rust’s module system.</p>
</blockquote>

<h3 id="modules1">
<span class="mr-2">modules1</span><a href="#modules1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>这里是考察module的可见性，默认是私有的，需要在外访问加<code class="language-plaintext highlighter-rouge">pub</code></p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td>
<td class="rouge-code"><pre><span class="k">mod</span> <span class="n">sausage_factory</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">get_secret_recipe</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
        <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"Ginger"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">make_sausage</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">get_secret_recipe</span><span class="p">();</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"sausage!"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="modules2">
<span class="mr-2">modules2</span><a href="#modules2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>和1类似，这里是重导，外部访问要求内部必须都是<code class="language-plaintext highlighter-rouge">pub</code>的</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
<td class="rouge-code"><pre><span class="nd">#[allow(dead_code)]</span>
<span class="k">mod</span> <span class="n">delicious_snacks</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">use</span> <span class="k">self</span><span class="p">::</span><span class="nn">fruits</span><span class="p">::</span><span class="n">PEAR</span> <span class="k">as</span> <span class="n">fruit</span><span class="p">;</span>
    <span class="k">pub</span> <span class="k">use</span> <span class="k">self</span><span class="p">::</span><span class="nn">veggies</span><span class="p">::</span><span class="n">CUCUMBER</span> <span class="k">as</span> <span class="n">veggie</span><span class="p">;</span>

    <span class="k">mod</span> <span class="n">fruits</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="k">const</span> <span class="n">PEAR</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">"Pear"</span><span class="p">;</span>
        <span class="k">pub</span> <span class="k">const</span> <span class="n">APPLE</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">"Apple"</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">mod</span> <span class="n">veggies</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="k">const</span> <span class="n">CUCUMBER</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">"Cucumber"</span><span class="p">;</span>
        <span class="k">pub</span> <span class="k">const</span> <span class="n">CARROT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">"Carrot"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="module3">
<span class="mr-2">module3</span><a href="#module3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>简单演示怎么导入公共模块内容</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">time</span><span class="p">::{</span><span class="n">SystemTime</span><span class="p">,</span> <span class="n">UNIX_EPOCH</span><span class="p">};</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="further-information-10">
<span class="mr-2">Further information</span><a href="#further-information-10" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<ul>
  <li><a href="https://doc.rust-lang.org/book/ch07-00-managing-growing-projects-with-packages-crates-and-modules.html">The Module System</a></li>
</ul>

<h2 id="hashmaps">
<span class="mr-2">Hashmaps</span><a href="#hashmaps" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<blockquote>
  <p>A <em>hash map</em> allows you to associate a value with a particular key.
You may also know this by the names <a href="https://en.cppreference.com/w/cpp/container/unordered_map"><em>unordered map</em> in C++</a>,
<a href="https://docs.python.org/3/tutorial/datastructures.html#dictionaries"><em>dictionary</em> in Python</a> or an <em>associative array</em> in other languages.</p>
</blockquote>

<blockquote>
  <p>This is the other data structure that we’ve been talking about before, when
talking about Vecs.</p>
</blockquote>

<h3 id="hashmap1">
<span class="mr-2">hashmap1</span><a href="#hashmap1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>创建和插入</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">fruit_basket</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="nb">u32</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">basket</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>

    <span class="n">basket</span><span class="nf">.insert</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"banana"</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">basket</span><span class="nf">.insert</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"apple"</span><span class="p">),</span> <span class="mi">3</span><span class="p">);</span>
    <span class="n">basket</span><span class="nf">.insert</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"watermelon"</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>

    <span class="n">basket</span>
<span class="p">}</span>

</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="hashmap2">
<span class="mr-2">hashmap2</span><a href="#hashmap2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>如果不存在再插入</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">fruit_basket</span><span class="p">(</span><span class="n">basket</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Fruit</span><span class="p">,</span> <span class="nb">u32</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">fruit_kinds</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nn">Fruit</span><span class="p">::</span><span class="n">Apple</span><span class="p">,</span>
        <span class="nn">Fruit</span><span class="p">::</span><span class="n">Banana</span><span class="p">,</span>
        <span class="nn">Fruit</span><span class="p">::</span><span class="n">Mango</span><span class="p">,</span>
        <span class="nn">Fruit</span><span class="p">::</span><span class="n">Lychee</span><span class="p">,</span>
        <span class="nn">Fruit</span><span class="p">::</span><span class="n">Pineapple</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="k">for</span> <span class="n">fruit</span> <span class="k">in</span> <span class="n">fruit_kinds</span> <span class="p">{</span>
        <span class="n">basket</span><span class="nf">.entry</span><span class="p">(</span><span class="n">fruit</span><span class="p">)</span><span class="nf">.or_insert</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="hashmap3">
<span class="mr-2">hashmap3</span><a href="#hashmap3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>一个插入的小练习</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td>
<td class="rouge-code"><pre><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">collections</span><span class="p">::</span><span class="n">HashMap</span><span class="p">;</span>

<span class="nd">#[derive(Default)]</span>
<span class="k">struct</span> <span class="n">Team</span> <span class="p">{</span>
    <span class="n">goals_scored</span><span class="p">:</span> <span class="nb">u8</span><span class="p">,</span>
    <span class="n">goals_conceded</span><span class="p">:</span> <span class="nb">u8</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">build_scores_table</span><span class="p">(</span><span class="n">results</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">HashMap</span><span class="o">&lt;&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="n">Team</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">scores</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>

    <span class="k">for</span> <span class="n">line</span> <span class="k">in</span> <span class="n">results</span><span class="nf">.lines</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">split_iterator</span> <span class="o">=</span> <span class="n">line</span><span class="nf">.split</span><span class="p">(</span><span class="sc">','</span><span class="p">);</span>
        <span class="c1">// NOTE: We use `unwrap` because we didn't deal with error handling yet.</span>
        <span class="k">let</span> <span class="n">team_1_name</span> <span class="o">=</span> <span class="n">split_iterator</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">team_2_name</span> <span class="o">=</span> <span class="n">split_iterator</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">team_1_score</span><span class="p">:</span> <span class="nb">u8</span> <span class="o">=</span> <span class="n">split_iterator</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">team_2_score</span><span class="p">:</span> <span class="nb">u8</span> <span class="o">=</span> <span class="n">split_iterator</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>

        <span class="k">let</span> <span class="n">entry1</span> <span class="o">=</span> <span class="n">scores</span><span class="nf">.entry</span><span class="p">(</span><span class="n">team_1_name</span><span class="p">)</span><span class="nf">.or_insert</span><span class="p">(</span><span class="n">Team</span> <span class="p">{</span> <span class="n">goals_scored</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">goals_conceded</span><span class="p">:</span> <span class="mi">0</span> <span class="p">});</span>
        <span class="n">entry1</span><span class="py">.goals_scored</span> <span class="o">+=</span> <span class="n">team_1_score</span><span class="p">;</span>
        <span class="n">entry1</span><span class="py">.goals_conceded</span> <span class="o">+=</span> <span class="n">team_2_score</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">entry2</span> <span class="o">=</span> <span class="n">scores</span><span class="nf">.entry</span><span class="p">(</span><span class="n">team_2_name</span><span class="p">)</span><span class="nf">.or_insert</span><span class="p">(</span><span class="n">Team</span> <span class="p">{</span> <span class="n">goals_scored</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">goals_conceded</span><span class="p">:</span> <span class="mi">0</span> <span class="p">});</span>
        <span class="n">entry2</span><span class="py">.goals_scored</span> <span class="o">+=</span> <span class="n">team_2_score</span><span class="p">;</span>
        <span class="n">entry2</span><span class="py">.goals_conceded</span> <span class="o">+=</span> <span class="n">team_1_score</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">scores</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="quiz2">
<span class="mr-2">quiz2</span><a href="#quiz2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>阶段性小练习，总结</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre></td>
<td class="rouge-code"><pre><span class="k">enum</span> <span class="n">Command</span> <span class="p">{</span>
    <span class="n">Uppercase</span><span class="p">,</span>
    <span class="n">Trim</span><span class="p">,</span>
    <span class="nf">Append</span><span class="p">(</span><span class="nb">usize</span><span class="p">),</span>
<span class="p">}</span>

<span class="k">mod</span> <span class="n">my_module</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="n">Command</span><span class="p">;</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">transformer</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">String</span><span class="p">,</span> <span class="n">Command</span><span class="p">)</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="n">input</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.map</span><span class="p">(|(</span><span class="n">item</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)|</span> <span class="p">{</span>
            <span class="k">match</span> <span class="n">cmd</span> <span class="p">{</span>
                <span class="nn">Command</span><span class="p">::</span><span class="n">Uppercase</span> <span class="k">=&gt;</span> <span class="p">{</span>
                    <span class="n">item</span><span class="nf">.to_uppercase</span><span class="p">()</span>
                <span class="p">}</span>
                <span class="nn">Command</span><span class="p">::</span><span class="n">Trim</span> <span class="k">=&gt;</span> <span class="p">{</span>
                    <span class="n">item</span><span class="nf">.trim</span><span class="p">()</span><span class="nf">.to_string</span><span class="p">()</span>
                <span class="p">}</span>
                <span class="nn">Command</span><span class="p">::</span><span class="nf">Append</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                    <span class="nd">format!</span><span class="p">(</span><span class="s">"{}{}"</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="s">"bar"</span><span class="nf">.repeat</span><span class="p">(</span><span class="o">*</span><span class="n">size</span><span class="p">))</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">})</span><span class="nf">.collect</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="nn">my_module</span><span class="p">::{</span><span class="n">transformer</span><span class="p">};</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="n">Command</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">it_works</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">input</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span>
            <span class="p">(</span><span class="s">"hello"</span><span class="nf">.to_string</span><span class="p">(),</span> <span class="nn">Command</span><span class="p">::</span><span class="n">Uppercase</span><span class="p">),</span>
            <span class="p">(</span><span class="s">" all roads lead to rome! "</span><span class="nf">.to_string</span><span class="p">(),</span> <span class="nn">Command</span><span class="p">::</span><span class="n">Trim</span><span class="p">),</span>
            <span class="p">(</span><span class="s">"foo"</span><span class="nf">.to_string</span><span class="p">(),</span> <span class="nn">Command</span><span class="p">::</span><span class="nf">Append</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>
            <span class="p">(</span><span class="s">"bar"</span><span class="nf">.to_string</span><span class="p">(),</span> <span class="nn">Command</span><span class="p">::</span><span class="nf">Append</span><span class="p">(</span><span class="mi">5</span><span class="p">)),</span>
        <span class="p">];</span>
        <span class="k">let</span> <span class="n">output</span> <span class="o">=</span> <span class="nf">transformer</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>

        <span class="nd">assert_eq!</span><span class="p">(</span>
            <span class="n">output</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s">"HELLO"</span><span class="p">,</span>
                <span class="s">"all roads lead to rome!"</span><span class="p">,</span>
                <span class="s">"foobar"</span><span class="p">,</span>
                <span class="s">"barbarbarbarbarbar"</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="further-information-11">
<span class="mr-2">Further information</span><a href="#further-information-11" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<ul>
  <li><a href="https://doc.rust-lang.org/book/ch08-03-hash-maps.html">Storing Keys with Associated Values in Hash Maps</a></li>
</ul>

<h2 id="options">
<span class="mr-2">Options</span><a href="#options" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<p>Type Option represents an optional value: every Option is either Some and contains a value, or None, and does not.
Option types are very common in Rust code, as they have a number of uses:</p>

<ul>
  <li>Initial values</li>
  <li>Return values for functions that are not defined over their entire input range (partial functions)</li>
  <li>Return value for otherwise reporting simple errors, where None is returned on error</li>
  <li>Optional struct fields</li>
  <li>Struct fields that can be loaned or “taken”</li>
  <li>Optional function arguments</li>
  <li>Nullable pointers</li>
  <li>Swapping things out of difficult situations</li>
</ul>

<h3 id="options1">
<span class="mr-2">Options1</span><a href="#options1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>Option的两个值，Some和None的基本使用</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">maybe_icecream</span><span class="p">(</span><span class="n">hour_of_day</span><span class="p">:</span> <span class="nb">u16</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">u16</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">hour_of_day</span> <span class="o">&lt;</span> <span class="mi">22</span> <span class="p">{</span> <span class="nf">Some</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="n">hour_of_day</span> <span class="o">&lt;</span> <span class="mi">24</span> <span class="p">{</span> <span class="nf">Some</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span> <span class="nb">None</span> <span class="p">}</span>
<span class="p">}</span>

<span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">raw_value</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">icecreams</span> <span class="o">=</span> <span class="nf">maybe_icecream</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>

        <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">icecreams</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span> <span class="c1">// Don't change this line.</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">check_icecream</span><span class="p">()</span> <span class="p">{</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nf">maybe_icecream</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nf">Some</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nf">maybe_icecream</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span> <span class="nf">Some</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nf">maybe_icecream</span><span class="p">(</span><span class="mi">18</span><span class="p">),</span> <span class="nf">Some</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nf">maybe_icecream</span><span class="p">(</span><span class="mi">22</span><span class="p">),</span> <span class="nf">Some</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nf">maybe_icecream</span><span class="p">(</span><span class="mi">23</span><span class="p">),</span> <span class="nf">Some</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nf">maybe_icecream</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span> <span class="nb">None</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nf">maybe_icecream</span><span class="p">(</span><span class="mi">25</span><span class="p">),</span> <span class="nb">None</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="options2">
<span class="mr-2">Options2</span><a href="#options2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>Option的使用，可以使用<code class="language-plaintext highlighter-rouge">if let</code>表达式解构里面的值，或者<code class="language-plaintext highlighter-rouge">while let</code></p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td>
<td class="rouge-code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">simple_option</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">target</span> <span class="o">=</span> <span class="s">"rustlings"</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">optional_target</span> <span class="o">=</span> <span class="nf">Some</span><span class="p">(</span><span class="n">target</span><span class="p">);</span>

        <span class="c1">// TODO: Make this an if-let statement whose value is `Some`.</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">=</span> <span class="n">optional_target</span> <span class="p">{</span>
            <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">target</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">layered_option</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">range</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">optional_integers</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">Option</span><span class="o">&lt;</span><span class="nb">i8</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="nb">None</span><span class="p">];</span>

        <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">..=</span><span class="n">range</span> <span class="p">{</span>
            <span class="n">optional_integers</span><span class="nf">.push</span><span class="p">(</span><span class="nf">Some</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="k">mut</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">range</span><span class="p">;</span>

        <span class="c1">// TODO: Make this a while-let statement. Remember that `Vec::pop()`</span>
        <span class="c1">// adds another layer of `Option`. You can do nested pattern matching</span>
        <span class="c1">// in if-let and while-let statements.</span>
        <span class="k">while</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="nf">Some</span><span class="p">(</span><span class="n">integer</span><span class="p">))</span> <span class="o">=</span> <span class="n">optional_integers</span><span class="nf">.pop</span><span class="p">()</span> <span class="p">{</span>
            <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">integer</span><span class="p">,</span> <span class="n">cursor</span><span class="p">);</span>
            <span class="n">cursor</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">if let Some(word) = optional_target { ... }</code>：这是一个 <code class="language-plaintext highlighter-rouge">if let</code> 表达式，用于模式匹配和解构 <code class="language-plaintext highlighter-rouge">optional_target</code>。如果 <code class="language-plaintext highlighter-rouge">optional_target</code> 是 <code class="language-plaintext highlighter-rouge">Some</code> 枚举，那么将 <code class="language-plaintext highlighter-rouge">word</code> 绑定为 <code class="language-plaintext highlighter-rouge">Some</code> 内部的值，并执行相应的代码块。</li>
  <li>
<code class="language-plaintext highlighter-rouge">while let Some(Some(integer)) = optional_integers.pop() { ... }</code>：
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">while let</code> 表达式用于循环处理 <code class="language-plaintext highlighter-rouge">optional_integers</code> 向量的元素，直到向量为空为止。</li>
      <li>
<code class="language-plaintext highlighter-rouge">Vec::pop()</code> 方法从向量的末尾移除一个元素，并返回其值。由于 <code class="language-plaintext highlighter-rouge">optional_integers</code> 是 <code class="language-plaintext highlighter-rouge">Vec&lt;Option&lt;i8&gt;&gt;</code> 类型，所以每次 <code class="language-plaintext highlighter-rouge">pop()</code> 返回的是 <code class="language-plaintext highlighter-rouge">Option&lt;i8&gt;</code>。</li>
      <li>
<code class="language-plaintext highlighter-rouge">Some(Some(integer))</code> 是模式匹配的方式，表示要匹配的值是 <code class="language-plaintext highlighter-rouge">Some</code> 枚举中的另一个 <code class="language-plaintext highlighter-rouge">Some</code> 枚举，其中包含一个整数 <code class="language-plaintext highlighter-rouge">integer</code>。</li>
      <li>在循环体内，断言 <code class="language-plaintext highlighter-rouge">integer</code> 的值应该等于 <code class="language-plaintext highlighter-rouge">cursor</code> 的当前值，并且 <code class="language-plaintext highlighter-rouge">cursor</code> 自减 1。</li>
    </ul>
  </li>
</ul>

<h3 id="option3">
<span class="mr-2">Option3</span><a href="#option3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>match直接使用对象，导致了主权丢失，后面继续使用值会报错</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td>
<td class="rouge-code"><pre><span class="nd">#[derive(Debug)]</span>
<span class="k">struct</span> <span class="n">Point</span> <span class="p">{</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">i32</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">i32</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">optional_point</span> <span class="o">=</span> <span class="nf">Some</span><span class="p">(</span><span class="n">Point</span> <span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">200</span> <span class="p">});</span>

    <span class="c1">// TODO: Fix the compiler error by adding something to this match statement.</span>
    <span class="k">match</span> <span class="n">optional_point</span> <span class="p">{</span>
        <span class="nf">Some</span><span class="p">(</span><span class="k">ref</span> <span class="n">p</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nd">println!</span><span class="p">(</span><span class="s">"Co-ordinates are {},{}"</span><span class="p">,</span> <span class="n">p</span><span class="py">.x</span><span class="p">,</span> <span class="n">p</span><span class="py">.y</span><span class="p">),</span>
        <span class="n">_</span> <span class="k">=&gt;</span> <span class="nd">panic!</span><span class="p">(</span><span class="s">"No match!"</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="nd">println!</span><span class="p">(</span><span class="s">"{optional_point:?}"</span><span class="p">);</span> <span class="c1">// Don't change this line.</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<p><code class="language-plaintext highlighter-rouge">ref</code>表示是借用值，避免所有权的转移</p>

<h3 id="further-information-12">
<span class="mr-2">Further Information</span><a href="#further-information-12" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<ul>
  <li><a href="https://doc.rust-lang.org/stable/book/ch10-01-syntax.html#in-enum-definitions">Option Enum Format</a></li>
  <li><a href="https://doc.rust-lang.org/std/option/">Option Module Documentation</a></li>
  <li><a href="https://doc.rust-lang.org/std/option/enum.Option.html">Option Enum Documentation</a></li>
  <li><a href="https://doc.rust-lang.org/rust-by-example/flow_control/if_let.html">if let</a></li>
  <li><a href="https://doc.rust-lang.org/rust-by-example/flow_control/while_let.html">while let</a></li>
</ul>

<h2 id="error-handling">
<span class="mr-2">Error handling</span><a href="#error-handling" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<p>Most errors aren’t serious enough to require the program to stop entirely.
Sometimes, when a function fails, it’s for a reason that you can easily interpret and respond to.
For example, if you try to open a file and that operation fails because the file doesn’t exist, you might want to create the file instead of terminating the process.</p>

<h3 id="errors1">
<span class="mr-2">errors1</span><a href="#errors1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>异常判断和前面判空类似，也是枚举</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
<td class="rouge-code"><pre><span class="nd">#[derive(Copy,</span> <span class="nd">PartialEq,</span> <span class="nd">PartialOrd,</span> <span class="nd">Eq,</span> <span class="nd">Ord,</span> <span class="nd">Debug,</span> <span class="nd">Hash)]</span>
<span class="nd">#[must_use</span> <span class="nd">=</span> <span class="s">"this `Result` may be an `Err` variant, which should be handled"</span><span class="nd">]</span>
<span class="nd">#[rustc_diagnostic_item</span> <span class="nd">=</span> <span class="s">"Result"</span><span class="nd">]</span>
<span class="nd">#[stable(feature</span> <span class="nd">=</span> <span class="s">"rust1"</span><span class="nd">,</span> <span class="nd">since</span> <span class="nd">=</span> <span class="s">"1.0.0"</span><span class="nd">)]</span>
<span class="k">pub</span> <span class="k">enum</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">E</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="cd">/// Contains the success value</span>
    <span class="nd">#[lang</span> <span class="nd">=</span> <span class="s">"Ok"</span><span class="nd">]</span>
    <span class="nd">#[stable(feature</span> <span class="nd">=</span> <span class="s">"rust1"</span><span class="nd">,</span> <span class="nd">since</span> <span class="nd">=</span> <span class="s">"1.0.0"</span><span class="nd">)]</span>
    <span class="nf">Ok</span><span class="p">(</span><span class="nd">#[stable(feature</span> <span class="nd">=</span> <span class="s">"rust1"</span><span class="nd">,</span> <span class="nd">since</span> <span class="nd">=</span> <span class="s">"1.0.0"</span><span class="nd">)]</span> <span class="n">T</span><span class="p">),</span>

    <span class="cd">/// Contains the error value</span>
    <span class="nd">#[lang</span> <span class="nd">=</span> <span class="s">"Err"</span><span class="nd">]</span>
    <span class="nd">#[stable(feature</span> <span class="nd">=</span> <span class="s">"rust1"</span><span class="nd">,</span> <span class="nd">since</span> <span class="nd">=</span> <span class="s">"1.0.0"</span><span class="nd">)]</span>
    <span class="nf">Err</span><span class="p">(</span><span class="nd">#[stable(feature</span> <span class="nd">=</span> <span class="s">"rust1"</span><span class="nd">,</span> <span class="nd">since</span> <span class="nd">=</span> <span class="s">"1.0.0"</span><span class="nd">)]</span> <span class="n">E</span><span class="p">),</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<p>所以改为</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">generate_nametag_text</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">name</span><span class="nf">.is_empty</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">Err</span><span class="p">(</span><span class="s">"Empty names aren't allowed"</span><span class="nf">.to_string</span><span class="p">())</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">Ok</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Hi! My name is {name}"</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="errors2">
<span class="mr-2">errors2</span><a href="#errors2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>进行一个解码</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">total_cost</span><span class="p">(</span><span class="n">item_quantity</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="nb">i32</span><span class="p">,</span> <span class="n">ParseIntError</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">processing_fee</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">cost_per_item</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

    <span class="k">let</span> <span class="n">qty</span> <span class="o">=</span> <span class="n">item_quantity</span><span class="py">.parse</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">i32</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="k">match</span> <span class="n">qty</span> <span class="p">{</span>
        <span class="nf">Ok</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">v</span> <span class="o">*</span> <span class="n">cost_per_item</span> <span class="o">+</span> <span class="n">processing_fee</span><span class="p">)</span> <span class="p">}</span>
        <span class="nf">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span> <span class="nf">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="errors3">
<span class="mr-2">errors3</span><a href="#errors3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>因为这里没有返回值，所以不能直接用<code class="language-plaintext highlighter-rouge">?</code>去抛出异常</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">tokens</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">pretend_user_input</span> <span class="o">=</span> <span class="s">"8"</span><span class="p">;</span>

    <span class="k">let</span> <span class="n">cost</span> <span class="o">=</span> <span class="nf">total_cost</span><span class="p">(</span><span class="n">pretend_user_input</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>

    <span class="k">if</span> <span class="n">cost</span> <span class="o">&gt;</span> <span class="n">tokens</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"You can't afford that many!"</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">tokens</span> <span class="o">-=</span> <span class="n">cost</span><span class="p">;</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"You now have {tokens} tokens."</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="errors4">
<span class="mr-2">errors4</span><a href="#errors4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>简单的演示怎么返回Ok与Err</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td>
<td class="rouge-code"><pre><span class="k">impl</span> <span class="n">PositiveNonzeroInteger</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">i64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">Self</span><span class="p">,</span> <span class="n">CreationError</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="nf">Ok</span><span class="p">(</span><span class="k">Self</span><span class="p">(</span><span class="n">value</span> <span class="k">as</span> <span class="nb">u64</span><span class="p">))</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="nf">Err</span><span class="p">(</span><span class="nn">CreationError</span><span class="p">::</span><span class="n">Zero</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">Err</span><span class="p">(</span><span class="nn">CreationError</span><span class="p">::</span><span class="n">Negative</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="error5">
<span class="mr-2">error5</span><a href="#error5" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>因为会抛出异常，所以表明异常返回值即可</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span> <span class="n">Error</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">pretend_user_input</span> <span class="o">=</span> <span class="s">"42"</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">x</span><span class="p">:</span> <span class="nb">i64</span> <span class="o">=</span> <span class="n">pretend_user_input</span><span class="nf">.parse</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"output={:?}"</span><span class="p">,</span> <span class="nn">PositiveNonzeroInteger</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">?</span><span class="p">);</span>
    <span class="nf">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="error6">
<span class="mr-2">error6</span><a href="#error6" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p><code class="language-plaintext highlighter-rouge">map_err</code>对错误值进行转换，而不影响正确的值</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td>
<td class="rouge-code"><pre><span class="nd">#[derive(PartialEq,</span> <span class="nd">Debug)]</span>
<span class="k">enum</span> <span class="n">ParsePosNonzeroError</span> <span class="p">{</span>
    <span class="nf">Creation</span><span class="p">(</span><span class="n">CreationError</span><span class="p">),</span>
    <span class="nf">ParseInt</span><span class="p">(</span><span class="n">ParseIntError</span><span class="p">),</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">ParsePosNonzeroError</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">from_creation</span><span class="p">(</span><span class="n">err</span><span class="p">:</span> <span class="n">CreationError</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="k">Self</span><span class="p">::</span><span class="nf">Creation</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">from_parseint</span><span class="p">(</span><span class="n">err</span><span class="p">:</span> <span class="n">ParseIntError</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span> <span class="k">Self</span><span class="p">::</span><span class="nf">ParseInt</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="nd">#[derive(PartialEq,</span> <span class="nd">Debug)]</span>
<span class="k">struct</span> <span class="nf">PositiveNonzeroInteger</span><span class="p">(</span><span class="nb">u64</span><span class="p">);</span>

<span class="k">impl</span> <span class="n">PositiveNonzeroInteger</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">i64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">Self</span><span class="p">,</span> <span class="n">CreationError</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">match</span> <span class="n">value</span> <span class="p">{</span>
            <span class="n">x</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nn">CreationError</span><span class="p">::</span><span class="n">Negative</span><span class="p">),</span>
            <span class="mi">0</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nn">CreationError</span><span class="p">::</span><span class="n">Zero</span><span class="p">),</span>
            <span class="n">x</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">(</span><span class="k">Self</span><span class="p">(</span><span class="n">x</span> <span class="k">as</span> <span class="nb">u64</span><span class="p">)),</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">parse</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">Self</span><span class="p">,</span> <span class="n">ParsePosNonzeroError</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">x</span><span class="p">:</span> <span class="nb">i64</span> <span class="o">=</span> <span class="n">s</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.map_err</span><span class="p">(</span><span class="nn">ParsePosNonzeroError</span><span class="p">::</span><span class="n">from_parseint</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
        <span class="k">Self</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="nf">.map_err</span><span class="p">(</span><span class="nn">ParsePosNonzeroError</span><span class="p">::</span><span class="n">from_creation</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="further-information-13">
<span class="mr-2">Further information</span><a href="#further-information-13" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<ul>
  <li><a href="https://doc.rust-lang.org/book/ch09-02-recoverable-errors-with-result.html">Error Handling</a></li>
  <li><a href="https://doc.rust-lang.org/book/ch10-01-syntax.html">Generics</a></li>
  <li><a href="https://doc.rust-lang.org/rust-by-example/error/result.html">Result</a></li>
  <li><a href="https://doc.rust-lang.org/rust-by-example/error/multiple_error_types/boxing_errors.html">Boxing errors</a></li>
</ul>

<h2 id="generics">
<span class="mr-2">Generics</span><a href="#generics" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<blockquote>
  <p>Generics is the topic of generalizing types and functionalities to broader cases.
This is extremely useful for reducing code duplication in many ways, but can call for some rather involved syntax.
Namely, being generic requires taking great care to specify over which types a generic type is actually considered valid.
The simplest and most common use of generics is for type parameters.</p>
</blockquote>

<h3 id="generics1">
<span class="mr-2">generics1</span><a href="#generics1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>需要一个可以同时存储<code class="language-plaintext highlighter-rouge">u8</code>和<code class="language-plaintext highlighter-rouge">i8</code>的数据结构，向上提升一下即可</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">numbers</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">i16</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>

    <span class="c1">// Don't change the lines below.</span>
    <span class="k">let</span> <span class="n">n1</span><span class="p">:</span> <span class="nb">u8</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
    <span class="n">numbers</span><span class="nf">.push</span><span class="p">(</span><span class="n">n1</span><span class="nf">.into</span><span class="p">());</span>
    <span class="k">let</span> <span class="n">n2</span><span class="p">:</span> <span class="nb">i8</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">numbers</span><span class="nf">.push</span><span class="p">(</span><span class="n">n2</span><span class="nf">.into</span><span class="p">());</span>

    <span class="nd">println!</span><span class="p">(</span><span class="s">"{numbers:?}"</span><span class="p">);</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="generics2">
<span class="mr-2">generics2</span><a href="#generics2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>泛型类和泛型方法</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td>
<td class="rouge-code"><pre><span class="k">struct</span> <span class="n">Wrapper</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Wrapper</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="n">Wrapper</span> <span class="p">{</span> <span class="n">value</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="further-information-14">
<span class="mr-2">Further information</span><a href="#further-information-14" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<ul>
  <li><a href="https://doc.rust-lang.org/stable/book/ch10-01-syntax.html">Generic Data Types</a></li>
  <li><a href="https://doc.rust-lang.org/rust-by-example/generics/bounds.html">Bounds</a></li>
</ul>

<h2 id="traits">
<span class="mr-2">Traits</span><a href="#traits" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<p>A trait is a collection of methods.</p>

<p>Data types can implement traits. To do so, the methods making up the trait are defined for the data type. For example, the <code class="language-plaintext highlighter-rouge">String</code> data type implements the <code class="language-plaintext highlighter-rouge">From&lt;&amp;str&gt;</code> trait. This allows a user to write <code class="language-plaintext highlighter-rouge">String::from("hello")</code>.</p>

<p>In this way, traits are somewhat similar to Java interfaces and C++ abstract classes.</p>

<p>Some additional common Rust traits include:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">Clone</code> (the <code class="language-plaintext highlighter-rouge">clone</code> method)</li>
  <li>
<code class="language-plaintext highlighter-rouge">Display</code> (which allows formatted display via <code class="language-plaintext highlighter-rouge">{}</code>)</li>
  <li>
<code class="language-plaintext highlighter-rouge">Debug</code> (which allows formatted display via <code class="language-plaintext highlighter-rouge">{:?}</code>)</li>
</ul>

<p>Because traits indicate shared behavior between data types, they are useful when writing generics.</p>

<h3 id="traits1">
<span class="mr-2">traits1</span><a href="#traits1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>给<code class="language-plaintext highlighter-rouge">String</code>实现一个特征，和接口类似</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td>
<td class="rouge-code"><pre><span class="k">trait</span> <span class="n">AppendBar</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">append_bar</span><span class="p">(</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">AppendBar</span> <span class="k">for</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="c1">// TODO: Implement `AppendBar` for the type `String`.</span>
    <span class="k">fn</span> <span class="nf">append_bar</span><span class="p">(</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="k">self</span> <span class="o">+</span> <span class="s">"Bar"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="traits2">
<span class="mr-2">traits2</span><a href="#traits2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>因为<code class="language-plaintext highlighter-rouge">Vec</code>是支持泛型的，这里要添加的为<code class="language-plaintext highlighter-rouge">String</code>，所以先把泛型写死，然后因为这里传入的是<code class="language-plaintext highlighter-rouge">self</code>，是不可变的，所以需要先转化为可变动</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td>
<td class="rouge-code"><pre><span class="k">trait</span> <span class="n">AppendBar</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">append_bar</span><span class="p">(</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">AppendBar</span> <span class="k">for</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">append_bar</span><span class="p">(</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">vec</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.clone</span><span class="p">();</span>
        <span class="n">vec</span><span class="nf">.push</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"Bar"</span><span class="p">));</span>
        <span class="n">vec</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="traits3">
<span class="mr-2">traits3</span><a href="#traits3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>需要一个简单的默认实现，和一般方法没什么区别</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre><span class="k">trait</span> <span class="n">Licensed</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">licensing_info</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
        <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"Default license"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="traits4">
<span class="mr-2">traits4</span><a href="#traits4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>对泛型的直接使用</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
<td class="rouge-code"><pre><span class="k">trait</span> <span class="n">Licensed</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">licensing_info</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
        <span class="s">"Default license"</span><span class="nf">.to_string</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">SomeSoftware</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">OtherSoftware</span><span class="p">;</span>

<span class="k">impl</span> <span class="n">Licensed</span> <span class="k">for</span> <span class="n">SomeSoftware</span> <span class="p">{}</span>
<span class="k">impl</span> <span class="n">Licensed</span> <span class="k">for</span> <span class="n">OtherSoftware</span> <span class="p">{}</span>

<span class="k">fn</span> <span class="nf">compare_license_types</span><span class="p">(</span><span class="n">software1</span><span class="p">:</span> <span class="k">impl</span> <span class="n">Licensed</span><span class="p">,</span> <span class="n">software2</span><span class="p">:</span> <span class="k">impl</span> <span class="n">Licensed</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
    <span class="n">software1</span><span class="nf">.licensing_info</span><span class="p">()</span> <span class="o">==</span> <span class="n">software2</span><span class="nf">.licensing_info</span><span class="p">()</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="traits5">
<span class="mr-2">traits5</span><a href="#traits5" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>泛型的多从约束</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td>
<td class="rouge-code"><pre><span class="k">trait</span> <span class="n">SomeTrait</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">some_function</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
        <span class="k">true</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">trait</span> <span class="n">OtherTrait</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">other_function</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
        <span class="k">true</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">SomeStruct</span><span class="p">;</span>
<span class="k">impl</span> <span class="n">SomeTrait</span> <span class="k">for</span> <span class="n">SomeStruct</span> <span class="p">{}</span>
<span class="k">impl</span> <span class="n">OtherTrait</span> <span class="k">for</span> <span class="n">SomeStruct</span> <span class="p">{}</span>

<span class="k">struct</span> <span class="n">OtherStruct</span><span class="p">;</span>
<span class="k">impl</span> <span class="n">SomeTrait</span> <span class="k">for</span> <span class="n">OtherStruct</span> <span class="p">{}</span>
<span class="k">impl</span> <span class="n">OtherTrait</span> <span class="k">for</span> <span class="n">OtherStruct</span> <span class="p">{}</span>

<span class="k">fn</span> <span class="nf">some_func</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="k">impl</span> <span class="n">SomeTrait</span> <span class="o">+</span> <span class="n">OtherTrait</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
    <span class="n">item</span><span class="nf">.some_function</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">item</span><span class="nf">.other_function</span><span class="p">()</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="further-information-15">
<span class="mr-2">Further information</span><a href="#further-information-15" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<ul>
  <li><a href="https://doc.rust-lang.org/book/ch10-02-traits.html">Traits</a></li>
</ul>

<h3 id="quiz3">
<span class="mr-2">quiz3</span><a href="#quiz3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>泛型总结，确保<code class="language-plaintext highlighter-rouge">T</code>是实现了的<code class="language-plaintext highlighter-rouge">Display</code>的</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td>
<td class="rouge-code"><pre><span class="k">struct</span> <span class="n">ReportCard</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">grade</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
    <span class="n">student_name</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="n">student_age</span><span class="p">:</span> <span class="nb">u8</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Display</span><span class="o">&gt;</span> <span class="n">ReportCard</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">print</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
        <span class="nd">format!</span><span class="p">(</span>
            <span class="s">"{} ({}) - achieved a grade of {}"</span><span class="p">,</span>
            <span class="o">&amp;</span><span class="k">self</span><span class="py">.student_name</span><span class="p">,</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.student_age</span><span class="p">,</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.grade</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h2 id="lifetimes">
<span class="mr-2">Lifetimes</span><a href="#lifetimes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<blockquote>
  <p>Lifetimes tell the compiler how to check whether references live long enough to be valid in any given situation. For example lifetimes say “make sure parameter ‘a’ lives as long as parameter ‘b’ so that the return value is valid”.</p>
</blockquote>

<blockquote>
  <p>They are only necessary on borrows, i.e. references, since copied parameters or moves are owned in their scope and cannot be referenced outside. Lifetimes mean that calling code of e.g. functions can be checked to make sure their arguments are valid. Lifetimes are restrictive of their callers.</p>
</blockquote>

<blockquote>
  <p>If you’d like to learn more about lifetime annotations, the <a href="https://tfpk.github.io/lifetimekata/">lifetimekata</a> project has a similar style of exercises to Rustlings, but is all about learning to write lifetime annotations.</p>
</blockquote>

<h3 id="lifetimes1">
<span class="mr-2">lifetimes1</span><a href="#lifetimes1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>当有多个借用参数时，这时无法区分，所以需要显示指定生命周期之间的关系，方便编译器判断回收。</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="n">longest</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">x</span><span class="nf">.len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">y</span><span class="nf">.len</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">x</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">y</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="lifetimes2">
<span class="mr-2">lifetimes2</span><a href="#lifetimes2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>因为生命周期是根据最短的来的，所以括号后就已经不安全了，所以得把最后的返回值打印放到括号结束之前</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">string1</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"long string is long"</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">{</span>
        <span class="k">let</span> <span class="n">string2</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"xyz"</span><span class="p">);</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nf">longest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">string1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">string2</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"The longest string is '{result}'"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="lifetimes3">
<span class="mr-2">lifetimes3</span><a href="#lifetimes3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>给struct内的借用对象指定生命周期</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td>
<td class="rouge-code"><pre><span class="k">struct</span> <span class="n">Book</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">author</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="further-information-16">
<span class="mr-2">Further information</span><a href="#further-information-16" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<ul>
  <li><a href="https://doc.rust-lang.org/stable/rust-by-example/scope/lifetime.html">Lifetimes (in Rust By Example)</a></li>
  <li><a href="https://doc.rust-lang.org/book/ch10-03-lifetime-syntax.html">Validating References with Lifetimes</a></li>
</ul>

<h2 id="tests">
<span class="mr-2">Tests</span><a href="#tests" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<blockquote>
  <p>Going out of order from the book to cover tests – many of the following exercises will ask you to make tests pass!</p>
</blockquote>

<h3 id="test1">
<span class="mr-2">test1</span><a href="#test1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>使用<code class="language-plaintext highlighter-rouge">use</code>引入要测试的函数</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">is_even</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">i64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
    <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>
<span class="p">}</span>

<span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="n">is_even</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">you_can_assert</span><span class="p">()</span> <span class="p">{</span>
        <span class="nd">assert!</span><span class="p">(</span><span class="nf">is_even</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
        <span class="nd">assert!</span><span class="p">(</span><span class="o">!</span><span class="nf">is_even</span><span class="p">(</span><span class="mi">11</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="test2">
<span class="mr-2">test2</span><a href="#test2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p><code class="language-plaintext highlighter-rouge">assert_eq!</code>判断两值相等</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">power_of_2</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">u8</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">u64</span> <span class="p">{</span>
    <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">n</span>
<span class="p">}</span>

<span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">you_can_assert_eq</span><span class="p">()</span> <span class="p">{</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nf">power_of_2</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">4</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nf">power_of_2</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">8</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nf">power_of_2</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">16</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nf">power_of_2</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="mi">256</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="test3">
<span class="mr-2">test3</span><a href="#test3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>主要是验证需要抛出异常，前面的测试也遇到过类似的，这里是让添加注解</p>
<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td>
<td class="rouge-code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">correct_width_and_height</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">rect</span> <span class="o">=</span> <span class="nn">Rectangle</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">rect</span><span class="py">.width</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span> <span class="c1">// Check width</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">rect</span><span class="py">.height</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span> <span class="c1">// Check height</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="nd">#[should_panic]</span>
    <span class="k">fn</span> <span class="nf">negative_width</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">_rect</span> <span class="o">=</span> <span class="nn">Rectangle</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="nd">#[should_panic]</span>
    <span class="k">fn</span> <span class="nf">negative_height</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">_rect</span> <span class="o">=</span> <span class="nn">Rectangle</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="further-information-17">
<span class="mr-2">Further information</span><a href="#further-information-17" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<ul>
  <li><a href="https://doc.rust-lang.org/book/ch11-01-writing-tests.html">Writing Tests</a></li>
</ul>

<h2 id="iterators">
<span class="mr-2">Iterators</span><a href="#iterators" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<blockquote>
  <p>This section will teach you about Iterators.</p>
</blockquote>

<h3 id="iterators1">
<span class="mr-2">iterators1</span><a href="#iterators1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>迭代器的基本使用</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td>
<td class="rouge-code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">iterators</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">my_fav_fruits</span> <span class="o">=</span> <span class="p">[</span><span class="s">"banana"</span><span class="p">,</span> <span class="s">"custard apple"</span><span class="p">,</span> <span class="s">"avocado"</span><span class="p">,</span> <span class="s">"peach"</span><span class="p">,</span> <span class="s">"raspberry"</span><span class="p">];</span>

        <span class="c1">// TODO: Create an iterator over the array.</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">fav_fruits_iterator</span> <span class="o">=</span> <span class="n">my_fav_fruits</span><span class="nf">.iter</span><span class="p">();</span>

        <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">fav_fruits_iterator</span><span class="nf">.next</span><span class="p">(),</span> <span class="nf">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="s">"banana"</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">fav_fruits_iterator</span><span class="nf">.next</span><span class="p">(),</span> <span class="nf">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="s">"custard apple"</span><span class="p">));</span> <span class="c1">// TODO: Replace `todo!()`</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">fav_fruits_iterator</span><span class="nf">.next</span><span class="p">(),</span> <span class="nf">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="s">"avocado"</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">fav_fruits_iterator</span><span class="nf">.next</span><span class="p">(),</span> <span class="nf">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="s">"peach"</span><span class="p">));</span> <span class="c1">// TODO: Replace `todo!()`</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">fav_fruits_iterator</span><span class="nf">.next</span><span class="p">(),</span> <span class="nf">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="s">"raspberry"</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">fav_fruits_iterator</span><span class="nf">.next</span><span class="p">(),</span> <span class="nb">None</span><span class="p">);</span> <span class="c1">// TODO: Replace `todo!()`</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="iterators2">
<span class="mr-2">iterators2</span><a href="#iterators2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>字符串和数组的迭代</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">capitalize_first</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">chars</span> <span class="o">=</span> <span class="n">input</span><span class="nf">.chars</span><span class="p">();</span>
    <span class="k">match</span> <span class="n">chars</span><span class="nf">.next</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">(),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="n">first</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">first</span><span class="nf">.to_uppercase</span><span class="p">()</span><span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">+</span> <span class="n">chars</span><span class="nf">.as_str</span><span class="p">(),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">capitalize_words_vector</span><span class="p">(</span><span class="n">words</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="o">&amp;</span><span class="nb">str</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">words</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.map</span><span class="p">(|</span><span class="n">x</span><span class="p">|</span> <span class="p">{</span>
        <span class="nf">capitalize_first</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="p">})</span><span class="nf">.collect</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">capitalize_words_string</span><span class="p">(</span><span class="n">words</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="o">&amp;</span><span class="nb">str</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">string</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
    <span class="n">words</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.for_each</span><span class="p">(|</span><span class="n">x</span><span class="p">|</span> <span class="p">{</span>
        <span class="n">string</span><span class="nf">.push_str</span><span class="p">(</span><span class="nf">capitalize_first</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="nf">.as_str</span><span class="p">());</span>
    <span class="p">});</span>
    <span class="n">string</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="iterators3">
<span class="mr-2">iterators3</span><a href="#iterators3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>完全相同的函数体，可以返回不同的结果</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td>
<td class="rouge-code"><pre><span class="nd">#[derive(Debug,</span> <span class="nd">PartialEq,</span> <span class="nd">Eq)]</span>
<span class="k">enum</span> <span class="n">DivisionError</span> <span class="p">{</span>
    <span class="c1">// Example: 42 / 0</span>
    <span class="n">DivideByZero</span><span class="p">,</span>
    <span class="c1">// Only case for `i64`: `i64::MIN / -1` because the result is `i64::MAX + 1`</span>
    <span class="n">IntegerOverflow</span><span class="p">,</span>
    <span class="c1">// Example: 5 / 2 = 2.5</span>
    <span class="n">NotDivisible</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">divide</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">i64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="nb">i64</span><span class="p">,</span> <span class="n">DivisionError</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nf">Err</span><span class="p">(</span><span class="nn">DivisionError</span><span class="p">::</span><span class="n">DivideByZero</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="nn">i64</span><span class="p">::</span><span class="n">MIN</span> <span class="o">&amp;&amp;</span> <span class="n">b</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">{</span>
        <span class="nf">Err</span><span class="p">(</span><span class="nn">DivisionError</span><span class="p">::</span><span class="n">IntegerOverflow</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nf">Ok</span><span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">Err</span><span class="p">(</span><span class="nn">DivisionError</span><span class="p">::</span><span class="n">NotDivisible</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">result_with_list</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">i64</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">DivisionError</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">27</span><span class="p">,</span> <span class="mi">297</span><span class="p">,</span> <span class="mi">38502</span><span class="p">,</span> <span class="mi">81</span><span class="p">];</span>
    <span class="n">numbers</span><span class="nf">.into_iter</span><span class="p">()</span><span class="nf">.map</span><span class="p">(|</span><span class="n">n</span><span class="p">|</span> <span class="nf">divide</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">27</span><span class="p">))</span><span class="nf">.collect</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">list_of_results</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">i64</span><span class="p">,</span> <span class="n">DivisionError</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">27</span><span class="p">,</span> <span class="mi">297</span><span class="p">,</span> <span class="mi">38502</span><span class="p">,</span> <span class="mi">81</span><span class="p">];</span>
    <span class="n">numbers</span><span class="nf">.into_iter</span><span class="p">()</span><span class="nf">.map</span><span class="p">(|</span><span class="n">n</span><span class="p">|</span> <span class="nf">divide</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">27</span><span class="p">))</span><span class="nf">.collect</span><span class="p">()</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<ul>
  <li>返回 <code class="language-plaintext highlighter-rouge">Result&lt;Vec&lt;i32&gt;, DivisionError&gt;</code>，表示这个函数在遇到任何错误时会立即返回错误，否则会返回包含所有成功结果的向量。</li>
  <li>返回 <code class="language-plaintext highlighter-rouge">Vec&lt;Result&lt;i32, DivisionError&gt;&gt;</code>, 这个函数将所有结果（成功和失败）都收集到向量中，而不会在遇到错误时立即返回。</li>
</ul>

<h3 id="iterators4">
<span class="mr-2">iterators4</span><a href="#iterators4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>迭代器求积</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">num</span><span class="p">:</span> <span class="nb">u64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">u64</span> <span class="p">{</span>
    <span class="p">(</span><span class="mi">1</span><span class="o">..=</span><span class="n">num</span><span class="p">)</span><span class="nf">.product</span><span class="p">()</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<p>或者使用<code class="language-plaintext highlighter-rouge">fold</code>但是会有警告</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td>
<td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">num</span><span class="p">:</span> <span class="nb">u64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">u64</span> <span class="p">{</span>
    <span class="p">(</span><span class="mi">1</span><span class="o">..=</span><span class="n">num</span><span class="p">)</span><span class="nf">.fold</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">|</span><span class="n">acc</span><span class="p">,</span> <span class="n">n</span><span class="p">|</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="iterators5">
<span class="mr-2">iterators5</span><a href="#iterators5" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>多层的迭代</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre></td>
<td class="rouge-code"><pre>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">collections</span><span class="p">::</span><span class="n">HashMap</span><span class="p">;</span>

<span class="nd">#[derive(Clone,</span> <span class="nd">Copy,</span> <span class="nd">PartialEq,</span> <span class="nd">Eq)]</span>
<span class="k">enum</span> <span class="n">Progress</span> <span class="p">{</span>
    <span class="nb">None</span><span class="p">,</span>
    <span class="nb">Some</span><span class="p">,</span>
    <span class="n">Complete</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">count_for</span><span class="p">(</span><span class="n">map</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">HashMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">Progress</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Progress</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="n">val</span> <span class="k">in</span> <span class="n">map</span><span class="nf">.values</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="o">*</span><span class="n">val</span> <span class="o">==</span> <span class="n">value</span> <span class="p">{</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">count</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">count_iterator</span><span class="p">(</span><span class="n">map</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">HashMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">Progress</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Progress</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="n">map</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.filter</span><span class="p">(|</span><span class="n">x</span><span class="p">|</span> <span class="p">{</span> <span class="n">x</span><span class="na">.1</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">value</span> <span class="p">})</span><span class="nf">.count</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">count_collection_for</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="n">HashMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">Progress</span><span class="o">&gt;</span><span class="p">],</span> <span class="n">value</span><span class="p">:</span> <span class="n">Progress</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="n">map</span> <span class="k">in</span> <span class="n">collection</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">val</span> <span class="k">in</span> <span class="n">map</span><span class="nf">.values</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="o">*</span><span class="n">val</span> <span class="o">==</span> <span class="n">value</span> <span class="p">{</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">count</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">count_collection_iterator</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="n">HashMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">Progress</span><span class="o">&gt;</span><span class="p">],</span> <span class="n">value</span><span class="p">:</span> <span class="n">Progress</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="n">collection</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.map</span><span class="p">(|</span><span class="n">x</span><span class="p">|</span> <span class="p">{</span> <span class="nf">count_iterator</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="p">})</span><span class="nf">.sum</span><span class="p">()</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="further-information-18">
<span class="mr-2">Further information</span><a href="#further-information-18" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<ul>
  <li><a href="https://doc.rust-lang.org/book/ch13-02-iterators.html">Iterator</a></li>
  <li><a href="https://doc.rust-lang.org/stable/std/iter/">Iterator documentation</a></li>
</ul>

<h2 id="smart-pointers">
<span class="mr-2">Smart Pointers</span><a href="#smart-pointers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<blockquote>
  <p>In Rust, smart pointers are variables that contain an address in memory and reference some other data, but they also have additional metadata and capabilities.
Smart pointers in Rust often own the data they point to, while references only borrow data.</p>
</blockquote>

<h3 id="box">
<span class="mr-2">box</span><a href="#box" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>用于把对象分配在堆上，也可以用于固定递归类型的数据大小，这里就是枚举递归了，所以用Box来解决</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
<td class="rouge-code"><pre><span class="nd">#[derive(PartialEq,</span> <span class="nd">Debug)]</span>
<span class="k">enum</span> <span class="n">List</span> <span class="p">{</span>
    <span class="nf">Cons</span><span class="p">(</span><span class="nb">i32</span><span class="p">,</span> <span class="nb">Box</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&gt;</span><span class="p">),</span>
    <span class="nb">Nil</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">create_empty_list</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">List</span> <span class="p">{</span>
    <span class="nn">List</span><span class="p">::</span><span class="nb">Nil</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">create_non_empty_list</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">List</span> <span class="p">{</span>
    <span class="nn">List</span><span class="p">::</span><span class="nf">Cons</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="nn">Box</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="nn">List</span><span class="p">::</span><span class="nb">Nil</span><span class="p">))</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="rc">
<span class="mr-2">rc</span><a href="#rc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>Rust的所有权使得一个对象只能有一个所有者，但在一些特殊的情况时很难处理，所以这里就引入了一个引用计数的对象<code class="language-plaintext highlighter-rouge">Rc</code></p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
</pre></td>
<td class="rouge-code"><pre><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">rc</span><span class="p">::</span><span class="nb">Rc</span><span class="p">;</span>

<span class="nd">#[derive(Debug)]</span>
<span class="k">struct</span> <span class="n">Sun</span><span class="p">;</span>

<span class="nd">#[allow(dead_code)]</span>
<span class="nd">#[derive(Debug)]</span>
<span class="k">enum</span> <span class="n">Planet</span> <span class="p">{</span>
    <span class="nf">Mercury</span><span class="p">(</span><span class="nb">Rc</span><span class="o">&lt;</span><span class="n">Sun</span><span class="o">&gt;</span><span class="p">),</span>
    <span class="nf">Venus</span><span class="p">(</span><span class="nb">Rc</span><span class="o">&lt;</span><span class="n">Sun</span><span class="o">&gt;</span><span class="p">),</span>
    <span class="nf">Earth</span><span class="p">(</span><span class="nb">Rc</span><span class="o">&lt;</span><span class="n">Sun</span><span class="o">&gt;</span><span class="p">),</span>
    <span class="nf">Mars</span><span class="p">(</span><span class="nb">Rc</span><span class="o">&lt;</span><span class="n">Sun</span><span class="o">&gt;</span><span class="p">),</span>
    <span class="nf">Jupiter</span><span class="p">(</span><span class="nb">Rc</span><span class="o">&lt;</span><span class="n">Sun</span><span class="o">&gt;</span><span class="p">),</span>
    <span class="nf">Saturn</span><span class="p">(</span><span class="nb">Rc</span><span class="o">&lt;</span><span class="n">Sun</span><span class="o">&gt;</span><span class="p">),</span>
    <span class="nf">Uranus</span><span class="p">(</span><span class="nb">Rc</span><span class="o">&lt;</span><span class="n">Sun</span><span class="o">&gt;</span><span class="p">),</span>
    <span class="nf">Neptune</span><span class="p">(</span><span class="nb">Rc</span><span class="o">&lt;</span><span class="n">Sun</span><span class="o">&gt;</span><span class="p">),</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">Planet</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">details</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"Hi from {self:?}!"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">rc1</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">sun</span> <span class="o">=</span> <span class="nn">Rc</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">Sun</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"reference count = {}"</span><span class="p">,</span> <span class="nn">Rc</span><span class="p">::</span><span class="nf">strong_count</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span> <span class="c1">// 1 reference</span>

        <span class="k">let</span> <span class="n">mercury</span> <span class="o">=</span> <span class="nn">Planet</span><span class="p">::</span><span class="nf">Mercury</span><span class="p">(</span><span class="nn">Rc</span><span class="p">::</span><span class="nf">clone</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"reference count = {}"</span><span class="p">,</span> <span class="nn">Rc</span><span class="p">::</span><span class="nf">strong_count</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span> <span class="c1">// 2 references</span>
        <span class="n">mercury</span><span class="nf">.details</span><span class="p">();</span>

        <span class="k">let</span> <span class="n">venus</span> <span class="o">=</span> <span class="nn">Planet</span><span class="p">::</span><span class="nf">Venus</span><span class="p">(</span><span class="nn">Rc</span><span class="p">::</span><span class="nf">clone</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"reference count = {}"</span><span class="p">,</span> <span class="nn">Rc</span><span class="p">::</span><span class="nf">strong_count</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span> <span class="c1">// 3 references</span>
        <span class="n">venus</span><span class="nf">.details</span><span class="p">();</span>

        <span class="k">let</span> <span class="n">earth</span> <span class="o">=</span> <span class="nn">Planet</span><span class="p">::</span><span class="nf">Earth</span><span class="p">(</span><span class="nn">Rc</span><span class="p">::</span><span class="nf">clone</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"reference count = {}"</span><span class="p">,</span> <span class="nn">Rc</span><span class="p">::</span><span class="nf">strong_count</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span> <span class="c1">// 4 references</span>
        <span class="n">earth</span><span class="nf">.details</span><span class="p">();</span>

        <span class="k">let</span> <span class="n">mars</span> <span class="o">=</span> <span class="nn">Planet</span><span class="p">::</span><span class="nf">Mars</span><span class="p">(</span><span class="nn">Rc</span><span class="p">::</span><span class="nf">clone</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"reference count = {}"</span><span class="p">,</span> <span class="nn">Rc</span><span class="p">::</span><span class="nf">strong_count</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span> <span class="c1">// 5 references</span>
        <span class="n">mars</span><span class="nf">.details</span><span class="p">();</span>

        <span class="k">let</span> <span class="n">jupiter</span> <span class="o">=</span> <span class="nn">Planet</span><span class="p">::</span><span class="nf">Jupiter</span><span class="p">(</span><span class="nn">Rc</span><span class="p">::</span><span class="nf">clone</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"reference count = {}"</span><span class="p">,</span> <span class="nn">Rc</span><span class="p">::</span><span class="nf">strong_count</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span> <span class="c1">// 6 references</span>
        <span class="n">jupiter</span><span class="nf">.details</span><span class="p">();</span>

        <span class="k">let</span> <span class="n">saturn</span> <span class="o">=</span> <span class="nn">Planet</span><span class="p">::</span><span class="nf">Saturn</span><span class="p">(</span><span class="nn">Rc</span><span class="p">::</span><span class="nf">clone</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"reference count = {}"</span><span class="p">,</span> <span class="nn">Rc</span><span class="p">::</span><span class="nf">strong_count</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span> <span class="c1">// 7 references</span>
        <span class="n">saturn</span><span class="nf">.details</span><span class="p">();</span>

        <span class="k">let</span> <span class="n">uranus</span> <span class="o">=</span> <span class="nn">Planet</span><span class="p">::</span><span class="nf">Uranus</span><span class="p">(</span><span class="nn">Rc</span><span class="p">::</span><span class="nf">clone</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"reference count = {}"</span><span class="p">,</span> <span class="nn">Rc</span><span class="p">::</span><span class="nf">strong_count</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span> <span class="c1">// 8 references</span>
        <span class="n">uranus</span><span class="nf">.details</span><span class="p">();</span>

        <span class="k">let</span> <span class="n">neptune</span> <span class="o">=</span> <span class="nn">Planet</span><span class="p">::</span><span class="nf">Neptune</span><span class="p">(</span><span class="nn">Rc</span><span class="p">::</span><span class="nf">clone</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"reference count = {}"</span><span class="p">,</span> <span class="nn">Rc</span><span class="p">::</span><span class="nf">strong_count</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span> <span class="c1">// 9 references</span>
        <span class="n">neptune</span><span class="nf">.details</span><span class="p">();</span>

        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nn">Rc</span><span class="p">::</span><span class="nf">strong_count</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">),</span> <span class="mi">9</span><span class="p">);</span>

        <span class="nf">drop</span><span class="p">(</span><span class="n">neptune</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"reference count = {}"</span><span class="p">,</span> <span class="nn">Rc</span><span class="p">::</span><span class="nf">strong_count</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span> <span class="c1">// 8 references</span>

        <span class="nf">drop</span><span class="p">(</span><span class="n">uranus</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"reference count = {}"</span><span class="p">,</span> <span class="nn">Rc</span><span class="p">::</span><span class="nf">strong_count</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span> <span class="c1">// 7 references</span>

        <span class="nf">drop</span><span class="p">(</span><span class="n">saturn</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"reference count = {}"</span><span class="p">,</span> <span class="nn">Rc</span><span class="p">::</span><span class="nf">strong_count</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span> <span class="c1">// 6 references</span>

        <span class="nf">drop</span><span class="p">(</span><span class="n">jupiter</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"reference count = {}"</span><span class="p">,</span> <span class="nn">Rc</span><span class="p">::</span><span class="nf">strong_count</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span> <span class="c1">// 5 references</span>

        <span class="nf">drop</span><span class="p">(</span><span class="n">mars</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"reference count = {}"</span><span class="p">,</span> <span class="nn">Rc</span><span class="p">::</span><span class="nf">strong_count</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span> <span class="c1">// 4 references</span>

        <span class="nf">drop</span><span class="p">(</span><span class="n">earth</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"reference count = {}"</span><span class="p">,</span> <span class="nn">Rc</span><span class="p">::</span><span class="nf">strong_count</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span> <span class="c1">// 3 references</span>

        <span class="nf">drop</span><span class="p">(</span><span class="n">venus</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"reference count = {}"</span><span class="p">,</span> <span class="nn">Rc</span><span class="p">::</span><span class="nf">strong_count</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span> <span class="c1">// 2 references</span>

        <span class="nf">drop</span><span class="p">(</span><span class="n">mercury</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"reference count = {}"</span><span class="p">,</span> <span class="nn">Rc</span><span class="p">::</span><span class="nf">strong_count</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">));</span> <span class="c1">// 1 reference</span>

        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nn">Rc</span><span class="p">::</span><span class="nf">strong_count</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sun</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="arc">
<span class="mr-2">arc</span><a href="#arc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>对于单线程场景，<code class="language-plaintext highlighter-rouge">rc</code>性能更高，但是在多线程场景并不适用，所以增加了<code class="language-plaintext highlighter-rouge">Arc</code>在多线程场景，当然性能会有损耗</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td>
<td class="rouge-code"><pre><span class="nd">#![forbid(unused_imports)]</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::{</span><span class="nn">sync</span><span class="p">::</span><span class="nb">Arc</span><span class="p">,</span> <span class="n">thread</span><span class="p">};</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">numbers</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">100u32</span><span class="p">)</span><span class="nf">.collect</span><span class="p">();</span>

    <span class="k">let</span> <span class="n">shared_numbers</span> <span class="o">=</span> <span class="nn">Arc</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">numbers</span><span class="p">);</span>

    <span class="k">let</span> <span class="k">mut</span> <span class="n">join_handles</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>

    <span class="k">for</span> <span class="n">offset</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="mi">8</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">child_numbers</span> <span class="o">=</span> <span class="nn">Arc</span><span class="p">::</span><span class="nf">clone</span><span class="p">(</span><span class="o">&amp;</span><span class="n">shared_numbers</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">handle</span> <span class="o">=</span> <span class="nn">thread</span><span class="p">::</span><span class="nf">spawn</span><span class="p">(</span><span class="k">move</span> <span class="p">||</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">sum</span><span class="p">:</span> <span class="nb">u32</span> <span class="o">=</span> <span class="n">child_numbers</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.filter</span><span class="p">(|</span><span class="o">&amp;&amp;</span><span class="n">n</span><span class="p">|</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="n">offset</span><span class="p">)</span><span class="nf">.sum</span><span class="p">();</span>
            <span class="nd">println!</span><span class="p">(</span><span class="s">"Sum of offset {offset} is {sum}"</span><span class="p">);</span>
        <span class="p">});</span>

        <span class="n">join_handles</span><span class="nf">.push</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">handle</span> <span class="k">in</span> <span class="n">join_handles</span><span class="nf">.into_iter</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">handle</span><span class="nf">.join</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="cow">
<span class="mr-2">cow</span><a href="#cow" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<p>可以指向一个借用的<code class="language-plaintext highlighter-rouge">（&amp;T）</code>或拥有的<code class="language-plaintext highlighter-rouge">（T）</code>数据。这对于处理那些可能需要克隆数据以进行修改的场景非常有用，但在大多数情况下只是读取数据，从而避免不必要的克隆开销。<code class="language-plaintext highlighter-rouge">Cow</code>常用于优化性能，特别是当你有只读和少数写入的场景。它可以帮助你延迟克隆数据，直到真的需要修改数据时才进行克隆。</p>

<div class="language-rust highlighter-rouge">
<div class="code-header">
        <span data-label-text="Rust"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td>
<td class="rouge-code"><pre><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">borrow</span><span class="p">::</span><span class="n">Cow</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">abs_all</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Cow</span><span class="o">&lt;</span><span class="p">[</span><span class="nb">i32</span><span class="p">]</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">ind</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">input</span><span class="nf">.len</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">value</span> <span class="o">=</span> <span class="n">input</span><span class="p">[</span><span class="n">ind</span><span class="p">];</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="n">input</span><span class="nf">.to_mut</span><span class="p">()[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">value</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">reference_mutation</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">vec</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">input</span> <span class="o">=</span> <span class="nn">Cow</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vec</span><span class="p">);</span>
        <span class="nf">abs_all</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">input</span><span class="p">);</span>
        <span class="nd">assert!</span><span class="p">(</span><span class="nd">matches!</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="nn">Cow</span><span class="p">::</span><span class="nf">Owned</span><span class="p">(</span><span class="n">_</span><span class="p">)));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">reference_no_mutation</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">vec</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">];</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">input</span> <span class="o">=</span> <span class="nn">Cow</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vec</span><span class="p">);</span>
        <span class="nf">abs_all</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">input</span><span class="p">);</span>
        <span class="nd">assert!</span><span class="p">(</span><span class="nd">matches!</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="nn">Cow</span><span class="p">::</span><span class="nf">Borrowed</span><span class="p">(</span><span class="n">_</span><span class="p">)));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">owned_no_mutation</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">vec</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">];</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">input</span> <span class="o">=</span> <span class="nn">Cow</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">vec</span><span class="p">);</span>
        <span class="nf">abs_all</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">input</span><span class="p">);</span>
        <span class="nd">assert!</span><span class="p">(</span><span class="nd">matches!</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="nn">Cow</span><span class="p">::</span><span class="nf">Owned</span><span class="p">(</span><span class="n">_</span><span class="p">)));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">owned_mutation</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">vec</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">input</span> <span class="o">=</span> <span class="nn">Cow</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">vec</span><span class="p">);</span>
        <span class="nf">abs_all</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">input</span><span class="p">);</span>
        <span class="nd">assert!</span><span class="p">(</span><span class="nd">matches!</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="nn">Cow</span><span class="p">::</span><span class="nf">Owned</span><span class="p">(</span><span class="n">_</span><span class="p">)));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>

<h3 id="further-information-19">
<span class="mr-2">Further Information</span><a href="#further-information-19" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<ul>
  <li><a href="https://doc.rust-lang.org/book/ch15-00-smart-pointers.html">Smart Pointers</a></li>
  <li><a href="https://doc.rust-lang.org/book/ch15-01-box.html">Using Box to Point to Data on the Heap</a></li>
  <li><a href="https://doc.rust-lang.org/book/ch15-04-rc.html">Rc&lt;T&gt;, the Reference Counted Smart Pointer</a></li>
  <li><a href="https://doc.rust-lang.org/book/ch16-03-shared-state.html">Shared-State Concurrency</a></li>
  <li><a href="https://doc.rust-lang.org/std/borrow/enum.Cow.html">Cow Documentation</a></li>
</ul>

<h2 id="threads">
<span class="mr-2">Threads</span><a href="#threads" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h2>

<blockquote>
  <p>In most current operating systems, an executed program’s code is run in a process, and the operating system manages multiple processes at once.
Within your program, you can also have independent parts that run simultaneously. The features that run these independent parts are called threads.</p>
</blockquote>

<h3 id="further-information-20">
<span class="mr-2">Further information</span><a href="#further-information-20" class="anchor text-muted"><i class="fas fa-hashtag"></i></a>
</h3>

<ul>
  <li><a href="https://doc.rust-lang.org/1.4.0/book/dining-philosophers.html">Dining Philosophers example</a></li>
  <li><a href="https://doc.rust-lang.org/book/ch16-01-threads.html">Using Threads to Run Code Simultaneously</a></li>
  <li><a href="https://doc.rust-lang.org/book/ch16-02-message-passing.html">Using Message Passing to Transfer Data Between Threads</a></li>
</ul>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  
  <div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i>
    
      <a href="/categories/rust/">Rust</a>
  </div>
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/tags/rustlings/" class="post-tag no-text-decoration">rustlings</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=rustlings+%E5%AD%A6%E4%B9%A0%E5%92%8C%E7%AD%94%E6%A1%88+-+Jiangker&amp;url=http%3A%2F%2F0.0.0.0%3A4000%2Fposts%2Frustlings%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=rustlings+%E5%AD%A6%E4%B9%A0%E5%92%8C%E7%AD%94%E6%A1%88+-+Jiangker&amp;u=http%3A%2F%2F0.0.0.0%3A4000%2Fposts%2Frustlings%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://t.me/share/url?url=http%3A%2F%2F0.0.0.0%3A4000%2Fposts%2Frustlings%2F&text=rustlings+%E5%AD%A6%E4%B9%A0%E5%92%8C%E7%AD%94%E6%A1%88+-+Jiangker" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!">
    </i>

  </span>
</div>


  </div>
<!-- .post-tail-bottom -->

</div>
<!-- div.post-tail-wrapper -->


      
    
    

    </div>
  </div> <!-- #core-wrapper -->

  <!-- pannel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">

    <div class="access">
      















  <div id="access-lastmod" class="post">
    <div class="panel-heading">Recently Updated</div>
    <ul class="post-content pl-0 pb-1 ml-1 mt-2">
      
        
        
        
      <li><a href="/posts/update_blog/">增加webhooks自动更新blog</a></li>
      
        
        
        
      <li><a href="/posts/rustlings/">rustlings 学习和答案</a></li>
      
        
        
        
      <li><a href="/posts/anotations/">SpringBoot常用注解</a></li>
      
        
        
        
      <li><a href="/posts/docker_mysql/">Docker部署MySQL</a></li>
      
        
        
        
      <li><a href="/posts/docker_yolov5/">Docker部署yolov5服务</a></li>
      
    </ul>
  </div> <!-- #access-lastmod -->



      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/docker/">docker</a>
    
      
      <a class="post-tag" href="/tags/android/">android</a>
    
      
      <a class="post-tag" href="/tags/jetpack/">jetpack</a>
    
      
      <a class="post-tag" href="/tags/raspberrypi/">raspberrypi</a>
    
      
      <a class="post-tag" href="/tags/gitlab/">gitlab</a>
    
      
      <a class="post-tag" href="/tags/actix-web/">actix-web</a>
    
      
      <a class="post-tag" href="/tags/aosp/">AOSP</a>
    
      
      <a class="post-tag" href="/tags/dockerfile/">dockerfile</a>
    
      
      <a class="post-tag" href="/tags/file/">file</a>
    
      
      <a class="post-tag" href="/tags/java/">java</a>
    

    </div>
  </div>


    </div>

    
      
      



<!-- BS-toc.js will be loaded at medium priority -->
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
  <nav id="toc" data-toggle="toc"></nav>
</div>


    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4">
    
      
      <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->





  <div id="related-posts" class="mb-2 mb-sm-4">
    <h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/serde_json/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small" data-ts="1697814000" data-df="ll">
  Oct 20, 2023
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>使用serde解析json</h3>
            <div class="text-muted small">
              <p>
                





                使用serde解析json

添加依赖

在Cargo.toml文件中添加以下行：

[dependencies]
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"


Object to json

use serde::{Serialize, Deserialize};

#[derive(Seri...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/update_blog/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small" data-ts="1697858880" data-df="ll">
  Oct 21, 2023
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>增加webhooks自动更新blog</h3>
            <div class="text-muted small">
              <p>
                





                前言

需要实现一个，当push代码后，实现一个github的webhooks的接口，然后拉去最新的内容，更新博客。之前由Spring boot实现过一款，但是简单的一个接口，占用的内存就比较高，所以现在改用rust来实现。这样可以使内存的占用直接控制在10mb以内。

增加依赖

[dependencies]
actix-web = "4.4.0"


代码

use std::proce...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/cross_compilation/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small" data-ts="1697944380" data-df="ll">
  Oct 22, 2023
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>rust交叉编译</h3>
            <div class="text-muted small">
              <p>
                





                前言

我为什么需要使用rust进行交叉编译，因为想使用rust编译和运行web程序，所以使用Dockerfile时需要分为构建和运行两个步骤进行，但是编译出的程序并不能直接运行，所以改用交叉编译的方式来打包，就可以在对应架构下的容器内直接运行。

配置环境

我这里直接使用docker镜像，搭建一个专门用来编译docker的容器。

首先在pwd/rust-build目录下准备好apt s...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


    
      
      <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/anaconda3/" class="btn btn-outline-primary" prompt="Older">
    <p>Ubuntu安装Anaconda3创建python环境</p>
  </a>
  

  
  <div class="btn btn-outline-primary disabled" prompt="Newer">
    <p>-</p>
  </div>
  

</div>

    
      
      <!--  The comments switcher -->


    
  </div>
</div>



        <!-- The Footer -->

<footer class="row pl-3 pr-3">
  <div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0">
    <div class="footer-left">
      <p class="mb-0">
        © 2024
        <a href="https://twitter.com/username">jiangker</a>.
        
        <span data-toggle="tooltip" data-placement="top" title="个人">蜀ICP备2023021215号</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        

        

        Powered by 
          <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
         with 
          <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
         theme.

      </p>
    </div>

  </div>

</footer>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/docker/">docker</a>
    
      
      <a class="post-tag" href="/tags/android/">android</a>
    
      
      <a class="post-tag" href="/tags/jetpack/">jetpack</a>
    
      
      <a class="post-tag" href="/tags/raspberrypi/">raspberrypi</a>
    
      
      <a class="post-tag" href="/tags/gitlab/">gitlab</a>
    
      
      <a class="post-tag" href="/tags/actix-web/">actix-web</a>
    
      
      <a class="post-tag" href="/tags/aosp/">AOSP</a>
    
      
      <a class="post-tag" href="/tags/dockerfile/">dockerfile</a>
    
      
      <a class="post-tag" href="/tags/file/">file</a>
    
      
      <a class="post-tag" href="/tags/java/">java</a>
    

    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    
      <!--
  mermaid-js loader
-->

<script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script>

<script>
  $(function() {
    function updateMermaid(event) {
      if (event.source === window && event.data &&
            event.data.direction === ModeToggle.ID) {

        const mode = event.data.message;

        if (typeof mermaid === "undefined") {
          return;
        }

        let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default");
        let config = { theme: expectedTheme };

        /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */
        $(".mermaid").each(function() {
          let svgCode = $(this).prev().children().html();
          $(this).removeAttr("data-processed");
          $(this).html(svgCode);
        });

        mermaid.initialize(config);
        mermaid.init(undefined, ".mermaid");
      }
    }

    let initTheme = "default";

    if ($("html[data-mode=dark]").length > 0
      || ($("html[data-mode]").length == 0
        && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) {
      initTheme = "dark";
    }

    let mermaidConf = {
      theme: initTheme  /* <default|dark|forest|neutral> */
    };

    /* Markdown converts to HTML */
    $("pre").has("code.language-mermaid").each(function() {
      let svgCode = $(this).children().html();
      $(this).addClass("unloaded");
      $(this).after(`<div class=\"mermaid\">${svgCode}</div>`);
    });

    mermaid.initialize(mermaidConf);

    window.addEventListener("message", updateMermaid);
  });
</script>

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    
      <div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false">
        <div class="toast-header">
          <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="toast-body text-center pt-0">
          <p class="pl-2 pr-2 mb-3">A new version of content is available.</p>
          <button type="button" class="btn btn-primary" aria-label="Update">
            Update
          </button>
        </div>
      </div>
    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No results found.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!--
  JS selector for site.
-->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup & clipboard -->
  

  







  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script>







  

  

  







  
    

    

  



  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script>








<script defer src="/assets/js/dist/post.min.js"></script>


  <!-- MathJax -->
  <script>
  /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */
  MathJax = {
    tex: {
      inlineMath: [              /* start/end delimiter pairs for in-line math */
        ['$','$'],
        ['\\(','\\)']
      ],
      displayMath: [             /* start/end delimiter pairs for display math */
        ['$$', '$$'],
        ['\\[', '\\]']
      ]
    }
  };
  </script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
  </script>


<!-- commons -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script>




  </body>

</html>
